if("undefined"==typeof SimileAjax){var SimileAjax={loaded:!1,loadingScriptsCount:0,error:null,params:{bundle:!1}};SimileAjax.Platform=new Object,SimileAjax.urlPrefix="undefined"!=typeof AjaxUrlPrefix?AjaxUrlPrefix:"/dist/src/"}SimileAjax.version="pre 2.3.0",SimileAjax.jQuery=jQuery.noConflict(!0),"undefined"==typeof window.$&&(window.$=SimileAjax.jQuery),SimileAjax.Platform.os={isMac:!1,isWin:!1,isWin32:!1,isUnix:!1},SimileAjax.Platform.browser={isIE:!1,isNetscape:!1,isMozilla:!1,isFirefox:!1,isOpera:!1,isSafari:!1,majorVersion:0,minorVersion:0},function(){var a=navigator.appName.toLowerCase(),b=navigator.userAgent.toLowerCase();SimileAjax.Platform.os.isMac=-1!=b.indexOf("mac"),SimileAjax.Platform.os.isWin=-1!=b.indexOf("win"),SimileAjax.Platform.os.isWin32=SimileAjax.Platform.isWin&&(-1!=b.indexOf("95")||-1!=b.indexOf("98")||-1!=b.indexOf("nt")||-1!=b.indexOf("win32")||-1!=b.indexOf("32bit")),SimileAjax.Platform.os.isUnix=-1!=b.indexOf("x11"),SimileAjax.Platform.browser.isIE=-1!=a.indexOf("microsoft"),SimileAjax.Platform.browser.isNetscape=-1!=a.indexOf("netscape"),SimileAjax.Platform.browser.isMozilla=-1!=b.indexOf("mozilla"),SimileAjax.Platform.browser.isFirefox=-1!=b.indexOf("firefox"),SimileAjax.Platform.browser.isOpera=-1!=a.indexOf("opera"),SimileAjax.Platform.browser.isSafari=-1!=a.indexOf("safari");var c=function(a){var b=a.split(".");SimileAjax.Platform.browser.majorVersion=parseInt(b[0]),SimileAjax.Platform.browser.minorVersion=parseInt(b[1])},d=function(a,b,c){var d=a.indexOf(b,c);return d>=0?d:a.length};if(SimileAjax.Platform.browser.isMozilla){var e=b.indexOf("mozilla/");e>=0&&c(b.substring(e+8,d(b," ",e)))}if(SimileAjax.Platform.browser.isIE){var e=b.indexOf("msie ");e>=0&&c(b.substring(e+5,d(b,";",e)))}if(SimileAjax.Platform.browser.isNetscape){var e=b.indexOf("rv:");e>=0&&c(b.substring(e+3,d(b,")",e)))}if(SimileAjax.Platform.browser.isFirefox){var e=b.indexOf("firefox/");e>=0&&c(b.substring(e+8,d(b," ",e)))}"localeCompare"in String.prototype||(String.prototype.localeCompare=function(a){return a>this?-1:this>a?1:0})}(),SimileAjax.Platform.getDefaultLocale=function(){return SimileAjax.Platform.clientLocale},SimileAjax.Debug={silent:!1},SimileAjax.Debug.log=function(a){var b;b="console"in window&&"log"in window.console?function(a){console.log(a)}:function(a){SimileAjax.Debug.silent||alert(a)},SimileAjax.Debug.log=b,b(a)},SimileAjax.Debug.warn=function(a){var b;b="console"in window&&"warn"in window.console?function(a){console.warn(a)}:function(a){SimileAjax.Debug.silent||alert(a)},SimileAjax.Debug.warn=b,b(a)},SimileAjax.Debug.exception=function(a,b){var c,d=SimileAjax.parseURLParameters();c="throw"==d.errors||"throw"==SimileAjax.params.errors?function(a){throw a}:"console"in window&&"error"in window.console?function(a,b){throw null!=b?console.error(b+" %o",a):console.error(a),a}:function(a,b){throw SimileAjax.Debug.silent||alert("Caught exception: "+b+"\n\nDetails: "+("description"in a?a.description:a)),a},SimileAjax.Debug.exception=c,c(a,b)},SimileAjax.Debug.objectToString=function(a){return SimileAjax.Debug._objectToString(a,"")},SimileAjax.Debug._objectToString=function(a,b){var c=b+" ";if("object"==typeof a){var d="{";for(e in a)d+=c+e+": "+SimileAjax.Debug._objectToString(a[e],c)+"\n";return d+=b+"}"}if("array"==typeof a){for(var d="[",e=0;e<a.length;e++)d+=SimileAjax.Debug._objectToString(a[e],c)+"\n";return d+=b+"]"}return a},SimileAjax.XmlHttp=new Object,SimileAjax.XmlHttp._onReadyStateChange=function(a,b,c){switch(a.readyState){case 4:try{0==a.status||200==a.status?c&&c(a):b&&b(a.statusText,a.status,a)}catch(d){SimileAjax.Debug.exception("XmlHttp: Error handling onReadyStateChange",d)}}},SimileAjax.XmlHttp._createRequest=function(){if(SimileAjax.Platform.browser.isIE)for(var a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],b=0;b<a.length;b++)try{var c=a[b],d=function(){return new ActiveXObject(c)},e=d();return SimileAjax.XmlHttp._createRequest=d,e}catch(f){}try{var d=function(){return new XMLHttpRequest},e=d();return SimileAjax.XmlHttp._createRequest=d,e}catch(f){throw new Error("Failed to create an XMLHttpRequest object")}},SimileAjax.XmlHttp.get=function(a,b,c){var d=SimileAjax.XmlHttp._createRequest();d.open("GET",a,!0),d.onreadystatechange=function(){SimileAjax.XmlHttp._onReadyStateChange(d,b,c)},d.send(null)},SimileAjax.XmlHttp.post=function(a,b,c,d){var e=SimileAjax.XmlHttp._createRequest();e.open("POST",a,!0),e.onreadystatechange=function(){SimileAjax.XmlHttp._onReadyStateChange(e,c,d)},e.send(b)},SimileAjax.XmlHttp._forceXML=function(a){try{a.overrideMimeType("text/xml")}catch(b){a.setrequestheader("Content-Type","text/xml")}},SimileAjax.JSON=new Object,function(){var m={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},s={array:function(a){var b,c,d,e,f=["["],g=a.length;for(d=0;g>d;d+=1)e=a[d],c=s[typeof e],c&&(e=c(e),"string"==typeof e&&(b&&(f[f.length]=","),f[f.length]=e,b=!0));return f[f.length]="]",f.join("")},"boolean":function(a){return String(a)},"null":function(){return"null"},number:function(a){return isFinite(a)?String(a):"null"},object:function(a){if(a){if(a instanceof Array)return s.array(a);var b,c,d,e,f=["{"];for(d in a)e=a[d],c=s[typeof e],c&&(e=c(e),"string"==typeof e&&(b&&(f[f.length]=","),f.push(s.string(d),":",e),b=!0));return f[f.length]="}",f.join("")}return"null"},string:function(a){return/["\\\x00-\x1f]/.test(a)&&(a=a.replace(/([\x00-\x1f\\"])/g,function(a,b){var c=m[b];return c?c:(c=b.charCodeAt(),"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16))})),'"'+a+'"'}};SimileAjax.JSON.toJSONString=function(a){return a instanceof Object?s.object(a):a instanceof Array?s.array(a):a.toString()},SimileAjax.JSON.parseJSON=function(){try{return!/[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/.test(this.replace(/"(\\.|[^"\\])*"/g,""))&&eval("("+this+")")}catch(e){return!1}}}(),SimileAjax.DOM=new Object,SimileAjax.DOM.registerEventWithObject=function(a,b,c,d){SimileAjax.DOM.registerEvent(a,b,function(a,b,e){return c[d].call(c,a,b,e)})},SimileAjax.DOM.registerEvent=function(a,b,c){var d=function(b){if(b=b?b:event?event:null){var d=b.target?b.target:b.srcElement?b.srcElement:null;return d&&(d=1==d.nodeType||9==d.nodeType?d:d.parentNode),c(a,b,d)}return!0};SimileAjax.Platform.browser.isIE?a.attachEvent("on"+b,d):a.addEventListener(b,d,!1)},SimileAjax.DOM.getPageCoordinates=function(a){var b=0,c=0;1!=a.nodeType&&(a=a.parentNode);for(var d=a;null!=d;)b+=d.offsetLeft,c+=d.offsetTop,d=d.offsetParent;for(var e=document.body;null!=a&&a!=e;)"scrollLeft"in a&&(b-=a.scrollLeft,c-=a.scrollTop),a=a.parentNode;return{left:b,top:c}},SimileAjax.DOM.getSize=function(a){var b=this.getStyle(a,"width"),c=this.getStyle(a,"height");return b.indexOf("px")>-1&&(b=b.replace("px","")),c.indexOf("px")>-1&&(c=c.replace("px","")),{w:b,h:c}},SimileAjax.DOM.getStyle=function(a,b){if(a.currentStyle)var c=a.currentStyle[b];else if(window.getComputedStyle)var c=document.defaultView.getComputedStyle(a,null).getPropertyValue(b);else var c="";return c},SimileAjax.DOM.getEventRelativeCoordinates=function(a,b){if(SimileAjax.Platform.browser.isIE){if("mousewheel"==a.type){var c=SimileAjax.DOM.getPageCoordinates(b);return{x:a.clientX-c.left,y:a.clientY-c.top}}return{x:a.offsetX,y:a.offsetY}}var c=SimileAjax.DOM.getPageCoordinates(b);return"DOMMouseScroll"==a.type&&SimileAjax.Platform.browser.isFirefox&&2==SimileAjax.Platform.browser.majorVersion?{x:a.screenX-c.left,y:a.screenY-c.top}:{x:a.pageX-c.left,y:a.pageY-c.top}},SimileAjax.DOM.getEventPageCoordinates=function(a){return SimileAjax.Platform.browser.isIE?{x:a.clientX+document.body.scrollLeft,y:a.clientY+document.body.scrollTop}:{x:a.pageX,y:a.pageY}},SimileAjax.DOM.hittest=function(a,b,c){return SimileAjax.DOM._hittest(document.body,a,b,c)},SimileAjax.DOM._hittest=function(a,b,c,d){var e=a.childNodes;a:for(var f=0;f<e.length;f++){for(var g=e[f],h=0;h<d.length;h++)if(g==d[h])continue a;if(0==g.offsetWidth&&0==g.offsetHeight){var i=SimileAjax.DOM._hittest(g,b,c,d);if(i!=g)return i}else{for(var j=0,k=0,l=g;l;)j+=l.offsetTop,k+=l.offsetLeft,l=l.offsetParent;if(b>=k&&c>=j&&b-k<g.offsetWidth&&c-j<g.offsetHeight)return SimileAjax.DOM._hittest(g,b,c,d);if(1==g.nodeType&&"TR"==g.tagName){var m=SimileAjax.DOM._hittest(g,b,c,d);if(m!=g)return m}}}return a},SimileAjax.DOM.cancelEvent=function(a){a.returnValue=!1,a.cancelBubble=!0,"preventDefault"in a&&a.preventDefault()},SimileAjax.DOM.appendClassName=function(a,b){for(var c=a.className.split(" "),d=0;d<c.length;d++)if(c[d]==b)return;c.push(b),a.className=c.join(" ")},SimileAjax.DOM.createInputElement=function(a){var b=document.createElement("div");return b.innerHTML="<input type='"+a+"' />",b.firstChild},SimileAjax.DOM.createDOMFromTemplate=function(a){var b={};return b.elmt=SimileAjax.DOM._createDOMFromTemplate(a,b,null),b},SimileAjax.DOM._createDOMFromTemplate=function(a,b,c){if(null==a)return null;if("object"!=typeof a){var d=document.createTextNode(a);return null!=c&&c.appendChild(d),d}var e=null;if("tag"in a){var f=a.tag;null!=c&&("tr"==f?e=c.insertRow(c.rows.length):"td"==f&&(e=c.insertCell(c.cells.length))),null==e&&(e="input"==f?SimileAjax.DOM.createInputElement(a.type):document.createElement(f),null!=c&&c.appendChild(e))}else e=a.elmt,null!=c&&c.appendChild(e);for(var g in a){var h=a[g];if("field"==g)b[h]=e;else if("className"==g)e.className=h;else if("id"==g)e.id=h;else if("title"==g)e.title=h;else if("type"==g&&"input"==e.tagName);else if("style"==g)for(n in h){var i=h[n];"float"==n&&(n=SimileAjax.Platform.browser.isIE?"styleFloat":"cssFloat"),e.style[n]=i}else if("children"==g)for(var j=0;j<h.length;j++)SimileAjax.DOM._createDOMFromTemplate(h[j],b,e);else"tag"!=g&&"elmt"!=g&&e.setAttribute(g,h)}return e},SimileAjax.DOM._cachedParent=null,SimileAjax.DOM.createElementFromString=function(a){return null==SimileAjax.DOM._cachedParent&&(SimileAjax.DOM._cachedParent=document.createElement("div")),SimileAjax.DOM._cachedParent.innerHTML=a,SimileAjax.DOM._cachedParent.firstChild},SimileAjax.DOM.createDOMFromString=function(a,b,c){var d="string"==typeof a?document.createElement(a):a;d.innerHTML=b;var e={elmt:d};return SimileAjax.DOM._processDOMChildrenConstructedFromString(e,d,null!=c?c:{}),e},SimileAjax.DOM._processDOMConstructedFromString=function(a,b,c){var d=b.id;if(null!=d&&d.length>0){if(b.removeAttribute("id"),d in c){var e=b.parentNode;return e.insertBefore(c[d],b),e.removeChild(b),void(a[d]=c[d])}a[d]=b}b.hasChildNodes()&&SimileAjax.DOM._processDOMChildrenConstructedFromString(a,b,c)},SimileAjax.DOM._processDOMChildrenConstructedFromString=function(a,b,c){for(var d=b.firstChild;null!=d;){var e=d.nextSibling;1==d.nodeType&&SimileAjax.DOM._processDOMConstructedFromString(a,d,c),d=e}},SimileAjax.Graphics=new Object,SimileAjax.Graphics.pngIsTranslucent=!SimileAjax.Platform.browser.isIE||SimileAjax.Platform.browser.majorVersion>6,SimileAjax.Graphics.pngIsTranslucent||SimileAjax.includeCssFile(document,SimileAjax.urlPrefix+"styles/graphics-ie6.css"),SimileAjax.Graphics._createTranslucentImage1=function(a,b){var c=document.createElement("img");return c.setAttribute("src",a),null!=b&&(c.style.verticalAlign=b),c},SimileAjax.Graphics._createTranslucentImage2=function(a,b){var c=document.createElement("img");return c.style.width="1px",c.style.height="1px",c.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+a+"', sizingMethod='image')",c.style.verticalAlign=null!=b?b:"middle",c},SimileAjax.Graphics.createTranslucentImage=SimileAjax.Graphics.pngIsTranslucent?SimileAjax.Graphics._createTranslucentImage1:SimileAjax.Graphics._createTranslucentImage2,SimileAjax.Graphics._createTranslucentImageHTML1=function(a,b){return'<img src="'+a+'"'+(null!=b?' style="vertical-align: '+b+';"':"")+" />"},SimileAjax.Graphics._createTranslucentImageHTML2=function(a,b){var c="width: 1px; height: 1px; filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+a+"', sizingMethod='image');"+(null!=b?" vertical-align: "+b+";":"");return"<img src='"+a+"' style=\""+c+'" />'},SimileAjax.Graphics.createTranslucentImageHTML=SimileAjax.Graphics.pngIsTranslucent?SimileAjax.Graphics._createTranslucentImageHTML1:SimileAjax.Graphics._createTranslucentImageHTML2,SimileAjax.Graphics.setOpacity=function(a,b){if(SimileAjax.Platform.browser.isIE)a.style.filter="progid:DXImageTransform.Microsoft.Alpha(Style=0,Opacity="+b+")";else{var c=(b/100).toString();a.style.opacity=c,a.style.MozOpacity=c}},SimileAjax.Graphics.bubbleConfig={containerCSSClass:"simileAjax-bubble-container",innerContainerCSSClass:"simileAjax-bubble-innerContainer",contentContainerCSSClass:"simileAjax-bubble-contentContainer",borderGraphicSize:50,borderGraphicCSSClassPrefix:"simileAjax-bubble-border-",arrowGraphicTargetOffset:33,arrowGraphicLength:100,arrowGraphicWidth:49,arrowGraphicCSSClassPrefix:"simileAjax-bubble-arrow-",closeGraphicCSSClass:"simileAjax-bubble-close",extraPadding:20},SimileAjax.Graphics.createBubbleForContentAndPoint=function(a,b,c,d,e,f){"number"!=typeof d&&(d=300),"number"!=typeof f&&(f=0),a.style.position="absolute",a.style.left="-5000px",a.style.top="0px",a.style.width=d+"px",document.body.appendChild(a),window.setTimeout(function(){var d=a.scrollWidth+10,g=a.scrollHeight+10,h=0;f>0&&g>f&&(g=f,h=d-25);var i=SimileAjax.Graphics.createBubbleForPoint(b,c,d,g,e);if(document.body.removeChild(a),a.style.position="static",a.style.left="",a.style.top="",h>0){var j=document.createElement("div");a.style.width="",j.style.width=h+"px",j.appendChild(a),i.content.appendChild(j)}else a.style.width=d+"px",i.content.appendChild(a)},200)},SimileAjax.Graphics.createBubbleForPoint=function(a,b,c,d,e){c=parseInt(c,10),d=parseInt(d,10);var f=SimileAjax.Graphics.bubbleConfig,g=SimileAjax.Graphics.pngIsTranslucent?"pngTranslucent":"pngNotTranslucent",h=(c+2*f.borderGraphicSize,d+2*f.borderGraphicSize,function(a){return a+" "+a+"-"+g}),i=document.createElement("div");i.className=h(f.containerCSSClass),i.style.width=c+"px",i.style.height=d+"px";var j=document.createElement("div");j.className=h(f.innerContainerCSSClass),i.appendChild(j);var k=function(){l._closed||(document.body.removeChild(l._div),l._doc=null,l._div=null,l._content=null,l._closed=!0)},l={_closed:!1},m=SimileAjax.WindowManager.pushLayer(k,!0,i);l._div=i,l.close=function(){SimileAjax.WindowManager.popLayer(m)};var n=function(a){var b=document.createElement("div");b.className=h(f.borderGraphicCSSClassPrefix+a),j.appendChild(b)};n("top-left"),n("top-right"),n("bottom-left"),n("bottom-right"),n("left"),n("right"),n("top"),n("bottom");var o=document.createElement("div");o.className=h(f.contentContainerCSSClass),j.appendChild(o),l.content=o;var p=document.createElement("div");return p.className=h(f.closeGraphicCSSClass),j.appendChild(p),SimileAjax.WindowManager.registerEventWithObject(p,"click",l,"close"),function(){var g=SimileAjax.Graphics.getWindowDimensions(),k=g.w,l=g.h,m=Math.ceil(f.arrowGraphicWidth/2),n=function(a){var b=document.createElement("div");return b.className=h(f.arrowGraphicCSSClassPrefix+"point-"+a),j.appendChild(b),b};if(a-m-f.borderGraphicSize-f.extraPadding>0&&a+m+f.borderGraphicSize+f.extraPadding<k){var o=a-Math.round(c/2);if(o=k/2>a?Math.max(o,f.extraPadding+f.borderGraphicSize):Math.min(o,k-f.extraPadding-f.borderGraphicSize-c),e&&"top"==e||!e&&b-f.arrowGraphicTargetOffset-d-f.borderGraphicSize-f.extraPadding>0){var p=n("down");return p.style.left=a-m-o+"px",i.style.left=o+"px",void(i.style.top=b-f.arrowGraphicTargetOffset-d+"px")}if(e&&"bottom"==e||!e&&b+f.arrowGraphicTargetOffset+d+f.borderGraphicSize+f.extraPadding<l){var p=n("up");return p.style.left=a-m-o+"px",i.style.left=o+"px",void(i.style.top=b+f.arrowGraphicTargetOffset+"px")}}var q=b-Math.round(d/2);if(q=l/2>b?Math.max(q,f.extraPadding+f.borderGraphicSize):Math.min(q,l-f.extraPadding-f.borderGraphicSize-d),e&&"left"==e||!e&&a-f.arrowGraphicTargetOffset-c-f.borderGraphicSize-f.extraPadding>0){var p=n("right");p.style.top=b-m-q+"px",i.style.top=q+"px",i.style.left=a-f.arrowGraphicTargetOffset-c+"px"}else{var p=n("left");p.style.top=b-m-q+"px",i.style.top=q+"px",i.style.left=a+f.arrowGraphicTargetOffset+"px"}}(),document.body.appendChild(i),l},SimileAjax.Graphics.getWindowDimensions=function(){return"number"==typeof window.innerHeight?{w:window.innerWidth,h:window.innerHeight}:document.documentElement&&document.documentElement.clientHeight?{w:document.documentElement.clientWidth,h:document.documentElement.clientHeight}:document.body&&document.body.clientHeight?{w:document.body.clientWidth,h:document.body.clientHeight}:void 0},SimileAjax.Graphics.createMessageBubble=function(a){var b=a.createElement("div");if(SimileAjax.Graphics.pngIsTranslucent){var c=a.createElement("div");c.style.height="33px",c.style.background="url("+SimileAjax.urlPrefix+"images/message-top-left.png) top left no-repeat",c.style.paddingLeft="44px",b.appendChild(c);var d=a.createElement("div");d.style.height="33px",d.style.background="url("+SimileAjax.urlPrefix+"images/message-top-right.png) top right no-repeat",c.appendChild(d);var e=a.createElement("div");e.style.background="url("+SimileAjax.urlPrefix+"images/message-left.png) top left repeat-y",e.style.paddingLeft="44px",b.appendChild(e);var f=a.createElement("div");f.style.background="url("+SimileAjax.urlPrefix+"images/message-right.png) top right repeat-y",f.style.paddingRight="44px",e.appendChild(f);var g=a.createElement("div");f.appendChild(g);var h=a.createElement("div");h.style.height="55px",h.style.background="url("+SimileAjax.urlPrefix+"images/message-bottom-left.png) bottom left no-repeat",h.style.paddingLeft="44px",b.appendChild(h);var i=a.createElement("div");i.style.height="55px",i.style.background="url("+SimileAjax.urlPrefix+"images/message-bottom-right.png) bottom right no-repeat",h.appendChild(i)}else{b.style.border="2px solid #7777AA",b.style.padding="20px",b.style.background="white",SimileAjax.Graphics.setOpacity(b,90);var g=a.createElement("div");b.appendChild(g)}return{containerDiv:b,contentDiv:g}},SimileAjax.Graphics.createAnimation=function(a,b,c,d,e){return new SimileAjax.Graphics._Animation(a,b,c,d,e)},SimileAjax.Graphics._Animation=function(a,b,c,d,e){this.f=a,this.cont="function"==typeof e?e:function(){},this.from=b,this.to=c,this.current=b,this.duration=d,this.start=(new Date).getTime(),this.timePassed=0},SimileAjax.Graphics._Animation.prototype.run=function(){var a=this;window.setTimeout(function(){a.step()},50)},SimileAjax.Graphics._Animation.prototype.step=function(){this.timePassed+=50;var a=this.timePassed/this.duration,b=-Math.cos(a*Math.PI)/2+.5,c=b*(this.to-this.from)+this.from;try{this.f(c,c-this.current)}catch(d){}this.current=c,this.timePassed<this.duration?this.run():(this.f(this.to,0),this.cont())},SimileAjax.Graphics.createStructuredDataCopyButton=function(a,b,c,d){var e=document.createElement("div");e.style.position="relative",e.style.display="inline",e.style.width=b+"px",e.style.height=c+"px",e.style.overflow="hidden",e.style.margin="2px",SimileAjax.Graphics.pngIsTranslucent?e.style.background="url("+a+") no-repeat":e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+a+"', sizingMethod='image')";var f;f=SimileAjax.Platform.browser.isIE?"filter:alpha(opacity=0)":"opacity: 0",e.innerHTML="<textarea rows='1' autocomplete='off' value='none' style='"+f+"' />";var g=e.firstChild;return g.style.width=b+"px",g.style.height=c+"px",g.onmousedown=function(a){a=a?a:event?event:null,2==a.button&&(g.value=d(),g.select())},e},SimileAjax.Graphics.getWidthHeight=function(a){var b,c;if(null==a.getBoundingClientRect)b=a.offsetWidth,c=a.offsetHeight;else{var d=a.getBoundingClientRect();b=Math.ceil(d.right-d.left),c=Math.ceil(d.bottom-d.top)}return{width:b,height:c}},SimileAjax.Graphics.getFontRenderingContext=function(a,b){return new SimileAjax.Graphics._FontRenderingContext(a,b)},SimileAjax.Graphics._FontRenderingContext=function(a,b){this._elmt=a,this._elmt.style.visibility="hidden","string"==typeof b?this._elmt.style.width=b:"number"==typeof b&&(this._elmt.style.width=b+"px")},SimileAjax.Graphics._FontRenderingContext.prototype.dispose=function(){this._elmt=null},SimileAjax.Graphics._FontRenderingContext.prototype.update=function(){this._elmt.innerHTML="A",this._lineHeight=this._elmt.offsetHeight},SimileAjax.Graphics._FontRenderingContext.prototype.computeSize=function(a,b){var c=this._elmt;c.innerHTML=a,c.className=void 0===b?"":b;var d=SimileAjax.Graphics.getWidthHeight(c);return c.className="",d},SimileAjax.Graphics._FontRenderingContext.prototype.getLineHeight=function(){return this._lineHeight},SimileAjax.DateTime=new Object,SimileAjax.DateTime.MILLISECOND=0,SimileAjax.DateTime.SECOND=1,SimileAjax.DateTime.MINUTE=2,SimileAjax.DateTime.HOUR=3,SimileAjax.DateTime.DAY=4,SimileAjax.DateTime.WEEK=5,SimileAjax.DateTime.MONTH=6,SimileAjax.DateTime.YEAR=7,SimileAjax.DateTime.DECADE=8,SimileAjax.DateTime.CENTURY=9,SimileAjax.DateTime.MILLENNIUM=10,SimileAjax.DateTime.EPOCH=-1,SimileAjax.DateTime.ERA=-2,SimileAjax.DateTime.gregorianUnitLengths=[],function(){var a=SimileAjax.DateTime,b=a.gregorianUnitLengths;b[a.MILLISECOND]=1,b[a.SECOND]=1e3,b[a.MINUTE]=60*b[a.SECOND],b[a.HOUR]=60*b[a.MINUTE],b[a.DAY]=24*b[a.HOUR],b[a.WEEK]=7*b[a.DAY],b[a.MONTH]=31*b[a.DAY],b[a.YEAR]=365*b[a.DAY],b[a.DECADE]=10*b[a.YEAR],b[a.CENTURY]=100*b[a.YEAR],b[a.MILLENNIUM]=1e3*b[a.YEAR]}(),SimileAjax.DateTime._dateRegexp=new RegExp("^(-?)([0-9]{4})("+["(-?([0-9]{2})(-?([0-9]{2}))?)","(-?([0-9]{3}))","(-?W([0-9]{2})(-?([1-7]))?)"].join("|")+")?$"),SimileAjax.DateTime._timezoneRegexp=new RegExp("Z|(([-+])([0-9]{2})(:?([0-9]{2}))?)$"),SimileAjax.DateTime._timeRegexp=new RegExp("^([0-9]{2})(:?([0-9]{2})(:?([0-9]{2})(.([0-9]+))?)?)?$"),SimileAjax.DateTime.setIso8601Date=function(a,b){var c=b.match(SimileAjax.DateTime._dateRegexp);if(!c)throw new Error("Invalid date string: "+b);var d="-"==c[1]?-1:1,e=d*c[2],f=c[5],g=c[7],h=c[9],i=c[11],j=c[13]?c[13]:1;if(a.setUTCFullYear(e),h)a.setUTCMonth(0),a.setUTCDate(Number(h));else if(i){a.setUTCMonth(0),a.setUTCDate(1);var k=a.getUTCDay(),l=k?k:7,m=Number(j)+7*Number(i);a.setUTCDate(4>=l?m+1-l:m+8-l)}else f&&(a.setUTCDate(1),a.setUTCMonth(f-1)),g&&a.setUTCDate(g);return a},SimileAjax.DateTime.setIso8601Time=function(a,b){var c=b.match(SimileAjax.DateTime._timeRegexp);if(!c)return SimileAjax.Debug.warn("Invalid time string: "+b),!1;var d=c[1],e=Number(c[3]?c[3]:0),f=c[5]?c[5]:0,g=c[7]?1e3*Number("0."+c[7]):0;return a.setUTCHours(d),a.setUTCMinutes(e),a.setUTCSeconds(f),a.setUTCMilliseconds(g),a},SimileAjax.DateTime.timezoneOffset=(new Date).getTimezoneOffset(),SimileAjax.DateTime.setIso8601=function(a,b){var c=null,d=b.split(-1==b.indexOf("T")?" ":"T");if(SimileAjax.DateTime.setIso8601Date(a,d[0]),2==d.length){var e=d[1].match(SimileAjax.DateTime._timezoneRegexp);e&&("Z"==e[0]?c=0:(c=60*Number(e[3])+Number(e[5]),c*="-"==e[2]?1:-1),d[1]=d[1].substr(0,d[1].length-e[0].length)),SimileAjax.DateTime.setIso8601Time(a,d[1])}return null==c&&(c=a.getTimezoneOffset()),a.setTime(a.getTime()+6e4*c),a},SimileAjax.DateTime.parseIso8601DateTime=function(a){try{return SimileAjax.DateTime.setIso8601(new Date(0),a)}catch(b){return null}},SimileAjax.DateTime.parseGregorianDateTime=function(a){if(null==a)return null;if(a instanceof Date)return a;var b=a.toString();if(b.length>0&&b.length<8){var c=b.indexOf(" ");if(c>0){var d=parseInt(b.substr(0,c)),e=b.substr(c+1);"bc"==e.toLowerCase()&&(d=1-d)}else var d=parseInt(b);var f=new Date(0);return f.setUTCFullYear(d),f}try{return new Date(Date.parse(b))}catch(g){return null}},SimileAjax.DateTime.roundDownToInterval=function(a,b,c,d,e){var f=c*SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.HOUR],g=new Date(a.getTime()+f),h=function(a){a.setUTCMilliseconds(0),a.setUTCSeconds(0),a.setUTCMinutes(0),a.setUTCHours(0)},i=function(a){h(a),a.setUTCDate(1),a.setUTCMonth(0)};switch(b){case SimileAjax.DateTime.MILLISECOND:var j=g.getUTCMilliseconds();g.setUTCMilliseconds(j-j%d);break;case SimileAjax.DateTime.SECOND:g.setUTCMilliseconds(0);var j=g.getUTCSeconds();g.setUTCSeconds(j-j%d);break;case SimileAjax.DateTime.MINUTE:g.setUTCMilliseconds(0),g.setUTCSeconds(0);var j=g.getUTCMinutes();g.setTime(g.getTime()-j%d*SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.MINUTE]);break;case SimileAjax.DateTime.HOUR:g.setUTCMilliseconds(0),g.setUTCSeconds(0),g.setUTCMinutes(0);var j=g.getUTCHours();g.setUTCHours(j-j%d);break;case SimileAjax.DateTime.DAY:h(g);break;case SimileAjax.DateTime.WEEK:h(g);var k=(g.getUTCDay()+7-e)%7;g.setTime(g.getTime()-k*SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.DAY]);break;case SimileAjax.DateTime.MONTH:h(g),g.setUTCDate(1);var j=g.getUTCMonth();g.setUTCMonth(j-j%d);break;case SimileAjax.DateTime.YEAR:i(g);var j=g.getUTCFullYear();g.setUTCFullYear(j-j%d);break;case SimileAjax.DateTime.DECADE:i(g),g.setUTCFullYear(10*Math.floor(g.getUTCFullYear()/10));break;case SimileAjax.DateTime.CENTURY:i(g),g.setUTCFullYear(100*Math.floor(g.getUTCFullYear()/100));break;case SimileAjax.DateTime.MILLENNIUM:i(g),g.setUTCFullYear(1e3*Math.floor(g.getUTCFullYear()/1e3))}a.setTime(g.getTime()-f)},SimileAjax.DateTime.roundUpToInterval=function(a,b,c,d,e){var f=a.getTime();SimileAjax.DateTime.roundDownToInterval(a,b,c,d,e),a.getTime()<f&&a.setTime(a.getTime()+SimileAjax.DateTime.gregorianUnitLengths[b]*d)},SimileAjax.DateTime.incrementByInterval=function(a,b,c){c="undefined"==typeof c?0:c;var d=c*SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.HOUR],e=new Date(a.getTime()+d);switch(b){case SimileAjax.DateTime.MILLISECOND:e.setTime(e.getTime()+1);break;case SimileAjax.DateTime.SECOND:e.setTime(e.getTime()+1e3);break;case SimileAjax.DateTime.MINUTE:e.setTime(e.getTime()+SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.MINUTE]);break;case SimileAjax.DateTime.HOUR:e.setTime(e.getTime()+SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.HOUR]);break;case SimileAjax.DateTime.DAY:e.setUTCDate(e.getUTCDate()+1);break;case SimileAjax.DateTime.WEEK:e.setUTCDate(e.getUTCDate()+7);break;case SimileAjax.DateTime.MONTH:e.setUTCMonth(e.getUTCMonth()+1);break;case SimileAjax.DateTime.YEAR:e.setUTCFullYear(e.getUTCFullYear()+1);break;case SimileAjax.DateTime.DECADE:e.setUTCFullYear(e.getUTCFullYear()+10);break;case SimileAjax.DateTime.CENTURY:e.setUTCFullYear(e.getUTCFullYear()+100);break;case SimileAjax.DateTime.MILLENNIUM:e.setUTCFullYear(e.getUTCFullYear()+1e3)}a.setTime(e.getTime()-d)},SimileAjax.DateTime.removeTimeZoneOffset=function(a,b){return new Date(a.getTime()+b*SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.HOUR])},SimileAjax.DateTime.getTimezone=function(){var a=(new Date).getTimezoneOffset();return a/-60},String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.startsWith=function(a){return this.length>=a.length&&this.substr(0,a.length)==a},String.prototype.endsWith=function(a){return this.length>=a.length&&this.substr(this.length-a.length)==a},String.substitute=function(a,b){for(var c="",d=0;d<a.length-1;){var e=a.indexOf("%",d);if(0>e||e==a.length-1)break;if(e>d&&"\\"==a.charAt(e-1))c+=a.substring(d,e-1)+"%",d=e+1;else{var f=parseInt(a.charAt(e+1));c+=isNaN(f)||f>=b.length?a.substring(d,e+2):a.substring(d,e)+b[f].toString(),d=e+2}}return d<a.length&&(c+=a.substring(d)),c},SimileAjax.HTML=new Object,SimileAjax.HTML._e2uHash={},function(){var a=SimileAjax.HTML._e2uHash;a.nbsp=" [space]",a.iexcl="¡",a.cent="¢",a.pound="£",a.curren="¤",a.yen="¥",a.brvbar="¦",a.sect="§",a.uml="¨",a.copy="©",a.ordf="ª",a.laquo="«",a.not="¬",a.shy="­",a.reg="®",a.macr="¯",a.deg="°",a.plusmn="±",a.sup2="²",a.sup3="³",a.acute="´",a.micro="µ",a.para="¶",a.middot="·",a.cedil="¸",a.sup1="¹",a.ordm="º",a.raquo="»",a.frac14="¼",a.frac12="½",a.frac34="¾",a.iquest="¿",a.Agrave="À",a.Aacute="Á",a.Acirc="Â",a.Atilde="Ã",a.Auml="Ä",a.Aring="Å",a.AElig="Æ",a.Ccedil="Ç",a.Egrave="È",a.Eacute="É",a.Ecirc="Ê",a.Euml="Ë",a.Igrave="Ì",a.Iacute="Í",a.Icirc="Î",a.Iuml="Ï",a.ETH="Ð",a.Ntilde="Ñ",a.Ograve="Ò",a.Oacute="Ó",a.Ocirc="Ô",a.Otilde="Õ",a.Ouml="Ö",a.times="×",a.Oslash="Ø",a.Ugrave="Ù",a.Uacute="Ú",a.Ucirc="Û",a.Uuml="Ü",a.Yacute="Ý",a.THORN="Þ",a.szlig="ß",a.agrave="à",a.aacute="á",a.acirc="â",a.atilde="ã",a.auml="ä",a.aring="å",a.aelig="æ",a.ccedil="ç",a.egrave="è",a.eacute="é",a.ecirc="ê",a.euml="ë",a.igrave="ì",a.iacute="í",a.icirc="î",a.iuml="ï",a.eth="ð",a.ntilde="ñ",a.ograve="ò",a.oacute="ó",a.ocirc="ô",a.otilde="õ",a.ouml="ö",a.divide="÷",a.oslash="ø",a.ugrave="ù",a.uacute="ú",a.ucirc="û",a.uuml="ü",a.yacute="ý",a.thorn="þ",a.yuml="ÿ",a.quot='"',a.amp="&",a.lt="<",a.gt=">",a.OElig="",a.oelig="œ",a.Scaron="Š",a.scaron="š",a.Yuml="Ÿ",a.circ="ˆ",a.tilde="˜",a.ensp=" ",a.emsp=" ",a.thinsp=" ",a.zwnj="‌",a.zwj="‍",a.lrm="‎",a.rlm="‏",a.ndash="–",a.mdash="—",a.lsquo="‘",a.rsquo="’",a.sbquo="‚",a.ldquo="“",a.rdquo="”",a.bdquo="„",a.dagger="†",a.Dagger="‡",a.permil="‰",a.lsaquo="‹",a.rsaquo="›",a.euro="€",a.fnof="ƒ",a.Alpha="Α",a.Beta="Β",a.Gamma="Γ",a.Delta="Δ",a.Epsilon="Ε",a.Zeta="Ζ",a.Eta="Η",a.Theta="Θ",a.Iota="Ι",a.Kappa="Κ",a.Lambda="Λ",a.Mu="Μ",a.Nu="Ν",a.Xi="Ξ",a.Omicron="Ο",a.Pi="Π",a.Rho="Ρ",a.Sigma="Σ",a.Tau="Τ",a.Upsilon="Υ",a.Phi="Φ",a.Chi="Χ",a.Psi="Ψ",a.Omega="Ω",a.alpha="α",a.beta="β",a.gamma="γ",a.delta="δ",a.epsilon="ε",a.zeta="ζ",a.eta="η",a.theta="θ",a.iota="ι",a.kappa="κ",a.lambda="λ",a.mu="μ",a.nu="ν",a.xi="ξ",a.omicron="ο",a.pi="π",a.rho="ρ",a.sigmaf="ς",a.sigma="σ",a.tau="τ",a.upsilon="υ",a.phi="φ",a.chi="χ",a.psi="ψ",a.omega="ω",a.thetasym="ϑ",a.upsih="ϒ",a.piv="ϖ",a.bull="•",a.hellip="…",a.prime="′",a.Prime="″",a.oline="‾",a.frasl="⁄",a.weierp="℘",a.image="ℑ",a.real="ℜ",a.trade="™",a.alefsym="ℵ",a.larr="←",a.uarr="↑",a.rarr="→",a.darr="↓",a.harr="↔",a.crarr="↵",a.lArr="⇐",a.uArr="⇑",a.rArr="⇒",a.dArr="⇓",a.hArr="⇔",a.forall="∀",a.part="∂",a.exist="∃",a.empty="∅",a.nabla="∇",a.isin="∈",a.notin="∉",a.ni="∋",a.prod="∏",a.sum="∑",a.minus="−",a.lowast="∗",a.radic="√",a.prop="∝",a.infin="∞",a.ang="∠",a.and="∧",a.or="∨",a.cap="∩",a.cup="∪",a["int"]="∫",a.there4="∴",a.sim="∼",a.cong="≅",a.asymp="≈",a.ne="≠",a.equiv="≡",a.le="≤",a.ge="≥",a.sub="⊂",a.sup="⊃",a.nsub="⊄",a.sube="⊆",a.supe="⊇",a.oplus="⊕",a.otimes="⊗",a.perp="⊥",a.sdot="⋅",a.lceil="⌈",a.rceil="⌉",a.lfloor="⌊",a.rfloor="⌋",a.lang="〈",a.rang="〉",a.loz="◊",a.spades="♠",a.clubs="♣",a.hearts="♥",a.diams="♦"}(),SimileAjax.HTML.deEntify=function(a){for(var b=SimileAjax.HTML._e2uHash,c=/&(\w+?);/;c.test(a);){var d=a.match(c);a=a.replace(c,b[d[1]])}return a},SimileAjax.Set=function(a){if(this._hash={},this._count=0,a instanceof Array)for(var b=0;b<a.length;b++)this.add(a[b]);else a instanceof SimileAjax.Set&&this.addSet(a)},SimileAjax.Set.prototype.add=function(a){return a in this._hash?!1:(this._hash[a]=!0,this._count++,!0)},SimileAjax.Set.prototype.addSet=function(a){for(var b in a._hash)this.add(b)},SimileAjax.Set.prototype.remove=function(a){return a in this._hash?(delete this._hash[a],this._count--,!0):!1},SimileAjax.Set.prototype.removeSet=function(a){for(var b in a._hash)this.remove(b)},SimileAjax.Set.prototype.retainSet=function(a){for(var b in this._hash)a.contains(b)||(delete this._hash[b],this._count--)},SimileAjax.Set.prototype.contains=function(a){return a in this._hash},SimileAjax.Set.prototype.size=function(){return this._count},SimileAjax.Set.prototype.toArray=function(){var a=[];for(var b in this._hash)a.push(b);return a},SimileAjax.Set.prototype.visit=function(a){for(var b in this._hash)if(1==a(b))break},SimileAjax.SortedArray=function(a,b){this._a=b instanceof Array?b:[],this._compare=a},SimileAjax.SortedArray.prototype.add=function(a){var b=this,c=this.find(function(c){return b._compare(c,a)});c<this._a.length?this._a.splice(c,0,a):this._a.push(a)},SimileAjax.SortedArray.prototype.remove=function(a){for(var b=this,c=this.find(function(c){return b._compare(c,a)});c<this._a.length&&0==this._compare(this._a[c],a);){if(this._a[c]==a)return this._a.splice(c,1),!0;c++}return!1},SimileAjax.SortedArray.prototype.removeAll=function(){
this._a=[]},SimileAjax.SortedArray.prototype.elementAt=function(a){return this._a[a]},SimileAjax.SortedArray.prototype.length=function(){return this._a.length},SimileAjax.SortedArray.prototype.find=function(a){for(var b=0,c=this._a.length;c>b;){var d=Math.floor((b+c)/2),e=a(this._a[d]);if(d==b)return 0>e?b+1:b;0>e?b=d:c=d}return b},SimileAjax.SortedArray.prototype.getFirst=function(){return this._a.length>0?this._a[0]:null},SimileAjax.SortedArray.prototype.getLast=function(){return this._a.length>0?this._a[this._a.length-1]:null},SimileAjax.EventIndex=function(a){var b=this;this._unit=null!=a?a:SimileAjax.NativeDateUnit,this._events=new SimileAjax.SortedArray(function(a,c){return b._unit.compare(a.getStart(),c.getStart())}),this._idToEvent={},this._indexed=!0},SimileAjax.EventIndex.prototype.getUnit=function(){return this._unit},SimileAjax.EventIndex.prototype.getEvent=function(a){return this._idToEvent[a]},SimileAjax.EventIndex.prototype.add=function(a){this._events.add(a),this._idToEvent[a.getID()]=a,this._indexed=!1},SimileAjax.EventIndex.prototype.removeAll=function(){this._events.removeAll(),this._idToEvent={},this._indexed=!1},SimileAjax.EventIndex.prototype.getCount=function(){return this._events.length()},SimileAjax.EventIndex.prototype.getIterator=function(a,b){return this._indexed||this._index(),new SimileAjax.EventIndex._Iterator(this._events,a,b,this._unit)},SimileAjax.EventIndex.prototype.getReverseIterator=function(a,b){return this._indexed||this._index(),new SimileAjax.EventIndex._ReverseIterator(this._events,a,b,this._unit)},SimileAjax.EventIndex.prototype.getAllIterator=function(){return new SimileAjax.EventIndex._AllIterator(this._events)},SimileAjax.EventIndex.prototype.getEarliestDate=function(){var a=this._events.getFirst();return null==a?null:a.getStart()},SimileAjax.EventIndex.prototype.getLatestDate=function(){var a=this._events.getLast();if(null==a)return null;this._indexed||this._index();for(var b=a._earliestOverlapIndex,c=this._events.elementAt(b).getEnd(),d=b+1;d<this._events.length();d++)c=this._unit.later(c,this._events.elementAt(d).getEnd());return c},SimileAjax.EventIndex.prototype._index=function(){for(var a=this._events.length(),b=0;a>b;b++){var c=this._events.elementAt(b);c._earliestOverlapIndex=b}for(var d=1,b=0;a>b;b++){var c=this._events.elementAt(b),e=c.getEnd();for(d=Math.max(d,b+1);a>d;){var f=this._events.elementAt(d),g=f.getStart();if(!(this._unit.compare(g,e)<0))break;f._earliestOverlapIndex=b,d++}}this._indexed=!0},SimileAjax.EventIndex._Iterator=function(a,b,c,d){this._events=a,this._startDate=b,this._endDate=c,this._unit=d,this._currentIndex=a.find(function(a){return d.compare(a.getStart(),b)}),this._currentIndex-1>=0&&(this._currentIndex=this._events.elementAt(this._currentIndex-1)._earliestOverlapIndex),this._currentIndex--,this._maxIndex=a.find(function(a){return d.compare(a.getStart(),c)}),this._hasNext=!1,this._next=null,this._findNext()},SimileAjax.EventIndex._Iterator.prototype={hasNext:function(){return this._hasNext},next:function(){if(this._hasNext){var a=this._next;return this._findNext(),a}return null},_findNext:function(){for(var a=this._unit;++this._currentIndex<this._maxIndex;){var b=this._events.elementAt(this._currentIndex);if(a.compare(b.getStart(),this._endDate)<0&&a.compare(b.getEnd(),this._startDate)>0)return this._next=b,void(this._hasNext=!0)}this._next=null,this._hasNext=!1}},SimileAjax.EventIndex._ReverseIterator=function(a,b,c,d){this._events=a,this._startDate=b,this._endDate=c,this._unit=d,this._minIndex=a.find(function(a){return d.compare(a.getStart(),b)}),this._minIndex-1>=0&&(this._minIndex=this._events.elementAt(this._minIndex-1)._earliestOverlapIndex),this._maxIndex=a.find(function(a){return d.compare(a.getStart(),c)}),this._currentIndex=this._maxIndex,this._hasNext=!1,this._next=null,this._findNext()},SimileAjax.EventIndex._ReverseIterator.prototype={hasNext:function(){return this._hasNext},next:function(){if(this._hasNext){var a=this._next;return this._findNext(),a}return null},_findNext:function(){for(var a=this._unit;--this._currentIndex>=this._minIndex;){var b=this._events.elementAt(this._currentIndex);if(a.compare(b.getStart(),this._endDate)<0&&a.compare(b.getEnd(),this._startDate)>0)return this._next=b,void(this._hasNext=!0)}this._next=null,this._hasNext=!1}},SimileAjax.EventIndex._AllIterator=function(a){this._events=a,this._index=0},SimileAjax.EventIndex._AllIterator.prototype={hasNext:function(){return this._index<this._events.length()},next:function(){return this._index<this._events.length()?this._events.elementAt(this._index++):null}},SimileAjax.NativeDateUnit=new Object,SimileAjax.NativeDateUnit.makeDefaultValue=function(){return new Date},SimileAjax.NativeDateUnit.cloneValue=function(a){return new Date(a.getTime())},SimileAjax.NativeDateUnit.getParser=function(a){return"string"==typeof a&&(a=a.toLowerCase()),"iso8601"==a||"iso 8601"==a?SimileAjax.DateTime.parseIso8601DateTime:SimileAjax.DateTime.parseGregorianDateTime},SimileAjax.NativeDateUnit.parseFromObject=function(a){return SimileAjax.DateTime.parseGregorianDateTime(a)},SimileAjax.NativeDateUnit.toNumber=function(a){return a.getTime()},SimileAjax.NativeDateUnit.fromNumber=function(a){return new Date(a)},SimileAjax.NativeDateUnit.compare=function(a,b){var c,d;return c="object"==typeof a?a.getTime():Number(a),d="object"==typeof b?b.getTime():Number(b),c-d},SimileAjax.NativeDateUnit.earlier=function(a,b){return SimileAjax.NativeDateUnit.compare(a,b)<0?a:b},SimileAjax.NativeDateUnit.later=function(a,b){return SimileAjax.NativeDateUnit.compare(a,b)>0?a:b},SimileAjax.NativeDateUnit.change=function(a,b){return new Date(a.getTime()+b)},SimileAjax.ListenerQueue=function(a){this._listeners=[],this._wildcardHandlerName=a},SimileAjax.ListenerQueue.prototype.add=function(a){this._listeners.push(a)},SimileAjax.ListenerQueue.prototype.remove=function(a){for(var b=this._listeners,c=0;c<b.length;c++)if(b[c]==a){b.splice(c,1);break}},SimileAjax.ListenerQueue.prototype.fire=function(a,b){for(var c=[].concat(this._listeners),d=0;d<c.length;d++){var e=c[d];if(a in e)try{e[a].apply(e,b)}catch(f){SimileAjax.Debug.exception("Error firing event of name "+a,f)}else if(null!=this._wildcardHandlerName&&this._wildcardHandlerName in e)try{e[this._wildcardHandlerName].apply(e,[a])}catch(f){SimileAjax.Debug.exception("Error firing event of name "+a+" to wildcard handler",f)}}},SimileAjax.History={maxHistoryLength:10,historyFile:"__history__.html",enabled:!0,_initialized:!1,_listeners:new SimileAjax.ListenerQueue,_actions:[],_baseIndex:0,_currentIndex:0,_plainDocumentTitle:document.title},SimileAjax.History.formatHistoryEntryTitle=function(a){return SimileAjax.History._plainDocumentTitle+" {"+a+"}"},SimileAjax.History.initialize=function(){if(!SimileAjax.History._initialized){if(SimileAjax.History.enabled){var a=document.createElement("iframe");a.id="simile-ajax-history",a.style.position="absolute",a.style.width="10px",a.style.height="10px",a.style.top="0px",a.style.left="0px",a.style.visibility="hidden",a.src=SimileAjax.History.historyFile+"?0",document.body.appendChild(a),SimileAjax.DOM.registerEvent(a,"load",SimileAjax.History._handleIFrameOnLoad),SimileAjax.History._iframe=a}SimileAjax.History._initialized=!0}},SimileAjax.History.addListener=function(a){SimileAjax.History.initialize(),SimileAjax.History._listeners.add(a)},SimileAjax.History.removeListener=function(a){SimileAjax.History.initialize(),SimileAjax.History._listeners.remove(a)},SimileAjax.History.addAction=function(a){SimileAjax.History.initialize(),SimileAjax.History._listeners.fire("onBeforePerform",[a]),window.setTimeout(function(){try{if(a.perform(),SimileAjax.History._listeners.fire("onAfterPerform",[a]),SimileAjax.History.enabled){SimileAjax.History._actions=SimileAjax.History._actions.slice(0,SimileAjax.History._currentIndex-SimileAjax.History._baseIndex),SimileAjax.History._actions.push(a),SimileAjax.History._currentIndex++;var b=SimileAjax.History._actions.length-SimileAjax.History.maxHistoryLength;b>0&&(SimileAjax.History._actions=SimileAjax.History._actions.slice(b),SimileAjax.History._baseIndex+=b);try{SimileAjax.History._iframe.contentWindow.location.search="?"+SimileAjax.History._currentIndex}catch(c){var d=SimileAjax.History.formatHistoryEntryTitle(a.label);document.title=d}}}catch(c){SimileAjax.Debug.exception(c,"Error adding action {"+a.label+"} to history")}},0)},SimileAjax.History.addLengthyAction=function(a,b,c){SimileAjax.History.addAction({perform:a,undo:b,label:c,uiLayer:SimileAjax.WindowManager.getBaseLayer(),lengthy:!0})},SimileAjax.History._handleIFrameOnLoad=function(){try{var a=SimileAjax.History._iframe.contentWindow.location.search,b=0==a.length?0:Math.max(0,parseInt(a.substr(1))),c=function(){var a=b-SimileAjax.History._currentIndex;SimileAjax.History._currentIndex+=a,SimileAjax.History._baseIndex+=a,SimileAjax.History._iframe.contentWindow.location.search="?"+b};if(b<SimileAjax.History._currentIndex)SimileAjax.History._listeners.fire("onBeforeUndoSeveral",[]),window.setTimeout(function(){for(;SimileAjax.History._currentIndex>b&&SimileAjax.History._currentIndex>SimileAjax.History._baseIndex;){SimileAjax.History._currentIndex--;var a=SimileAjax.History._actions[SimileAjax.History._currentIndex-SimileAjax.History._baseIndex];try{a.undo()}catch(d){SimileAjax.Debug.exception(d,"History: Failed to undo action {"+a.label+"}")}}SimileAjax.History._listeners.fire("onAfterUndoSeveral",[]),c()},0);else if(b>SimileAjax.History._currentIndex)SimileAjax.History._listeners.fire("onBeforeRedoSeveral",[]),window.setTimeout(function(){for(;SimileAjax.History._currentIndex<b&&SimileAjax.History._currentIndex-SimileAjax.History._baseIndex<SimileAjax.History._actions.length;){var a=SimileAjax.History._actions[SimileAjax.History._currentIndex-SimileAjax.History._baseIndex];try{a.perform()}catch(d){SimileAjax.Debug.exception(d,"History: Failed to redo action {"+a.label+"}")}SimileAjax.History._currentIndex++}SimileAjax.History._listeners.fire("onAfterRedoSeveral",[]),c()},0);else{var d=SimileAjax.History._currentIndex-SimileAjax.History._baseIndex-1,e=d>=0&&d<SimileAjax.History._actions.length?SimileAjax.History.formatHistoryEntryTitle(SimileAjax.History._actions[d].label):SimileAjax.History._plainDocumentTitle;SimileAjax.History._iframe.contentWindow.document.title=e,document.title=e}}catch(f){}},SimileAjax.History.getNextUndoAction=function(){try{var a=SimileAjax.History._currentIndex-SimileAjax.History._baseIndex-1;return SimileAjax.History._actions[a]}catch(b){return null}},SimileAjax.History.getNextRedoAction=function(){try{var a=SimileAjax.History._currentIndex-SimileAjax.History._baseIndex;return SimileAjax.History._actions[a]}catch(b){return null}},SimileAjax.WindowManager={_initialized:!1,_listeners:[],_draggedElement:null,_draggedElementCallback:null,_dropTargetHighlightElement:null,_lastCoords:null,_ghostCoords:null,_draggingMode:"",_dragging:!1,_layers:[]},SimileAjax.WindowManager.initialize=function(){SimileAjax.WindowManager._initialized||(SimileAjax.DOM.registerEvent(document.body,"mousedown",SimileAjax.WindowManager._onBodyMouseDown),SimileAjax.DOM.registerEvent(document.body,"mousemove",SimileAjax.WindowManager._onBodyMouseMove),SimileAjax.DOM.registerEvent(document.body,"mouseup",SimileAjax.WindowManager._onBodyMouseUp),SimileAjax.DOM.registerEvent(document,"keydown",SimileAjax.WindowManager._onBodyKeyDown),SimileAjax.DOM.registerEvent(document,"keyup",SimileAjax.WindowManager._onBodyKeyUp),SimileAjax.WindowManager._layers.push({index:0}),SimileAjax.WindowManager._historyListener={onBeforeUndoSeveral:function(){},onAfterUndoSeveral:function(){},onBeforeUndo:function(){},onAfterUndo:function(){},onBeforeRedoSeveral:function(){},onAfterRedoSeveral:function(){},onBeforeRedo:function(){},onAfterRedo:function(){}},SimileAjax.History.addListener(SimileAjax.WindowManager._historyListener),SimileAjax.WindowManager._initialized=!0)},SimileAjax.WindowManager.getBaseLayer=function(){return SimileAjax.WindowManager.initialize(),SimileAjax.WindowManager._layers[0]},SimileAjax.WindowManager.getHighestLayer=function(){return SimileAjax.WindowManager.initialize(),SimileAjax.WindowManager._layers[SimileAjax.WindowManager._layers.length-1]},SimileAjax.WindowManager.registerEventWithObject=function(a,b,c,d,e){SimileAjax.WindowManager.registerEvent(a,b,function(a,b,e){return c[d].call(c,a,b,e)},e)},SimileAjax.WindowManager.registerEvent=function(a,b,c,d){null==d&&(d=SimileAjax.WindowManager.getHighestLayer());var e=function(a,b,e){if(SimileAjax.WindowManager._canProcessEventAtLayer(d)){SimileAjax.WindowManager._popToLayer(d.index);try{c(a,b,e)}catch(f){SimileAjax.Debug.exception(f)}}return SimileAjax.DOM.cancelEvent(b),!1};SimileAjax.DOM.registerEvent(a,b,e)},SimileAjax.WindowManager.pushLayer=function(a,b,c){var d={onPop:a,index:SimileAjax.WindowManager._layers.length,ephemeral:b,elmt:c};return SimileAjax.WindowManager._layers.push(d),d},SimileAjax.WindowManager.popLayer=function(a){for(var b=1;b<SimileAjax.WindowManager._layers.length;b++)if(SimileAjax.WindowManager._layers[b]==a){SimileAjax.WindowManager._popToLayer(b-1);break}},SimileAjax.WindowManager.popAllLayers=function(){SimileAjax.WindowManager._popToLayer(0)},SimileAjax.WindowManager.registerForDragging=function(a,b,c){SimileAjax.WindowManager.registerEvent(a,"mousedown",function(a,c){SimileAjax.WindowManager._handleMouseDown(a,c,b)},c)},SimileAjax.WindowManager._popToLayer=function(a){for(;a+1<SimileAjax.WindowManager._layers.length;)try{var b=SimileAjax.WindowManager._layers.pop();null!=b.onPop&&b.onPop()}catch(c){}},SimileAjax.WindowManager._canProcessEventAtLayer=function(a){if(a.index==SimileAjax.WindowManager._layers.length-1)return!0;for(var b=a.index+1;b<SimileAjax.WindowManager._layers.length;b++)if(!SimileAjax.WindowManager._layers[b].ephemeral)return!1;return!0},SimileAjax.WindowManager.cancelPopups=function(a){for(var b=a?SimileAjax.DOM.getEventPageCoordinates(a):{x:-1,y:-1},c=SimileAjax.WindowManager._layers.length-1;c>0&&SimileAjax.WindowManager._layers[c].ephemeral;){var d=SimileAjax.WindowManager._layers[c];if(null!=d.elmt){var e=d.elmt,f=SimileAjax.DOM.getPageCoordinates(e);if(b.x>=f.left&&b.x<f.left+e.offsetWidth&&b.y>=f.top&&b.y<f.top+e.offsetHeight)break}c--}SimileAjax.WindowManager._popToLayer(c)},SimileAjax.WindowManager._onBodyMouseDown=function(a,b){"eventPhase"in b&&b.eventPhase!=b.BUBBLING_PHASE||SimileAjax.WindowManager.cancelPopups(b)},SimileAjax.WindowManager._handleMouseDown=function(a,b,c){return SimileAjax.WindowManager._draggedElement=a,SimileAjax.WindowManager._draggedElementCallback=c,SimileAjax.WindowManager._lastCoords={x:b.clientX,y:b.clientY},SimileAjax.DOM.cancelEvent(b),!1},SimileAjax.WindowManager._onBodyKeyDown=function(a,b){if(SimileAjax.WindowManager._dragging)if(27==b.keyCode)SimileAjax.WindowManager._cancelDragging();else if((17==b.keyCode||16==b.keyCode)&&"copy"!=SimileAjax.WindowManager._draggingMode){SimileAjax.WindowManager._draggingMode="copy";var c=SimileAjax.Graphics.createTranslucentImage(SimileAjax.urlPrefix+"images/copy.png");c.style.position="absolute",c.style.left=SimileAjax.WindowManager._ghostCoords.left-16+"px",c.style.top=SimileAjax.WindowManager._ghostCoords.top+"px",document.body.appendChild(c),SimileAjax.WindowManager._draggingModeIndicatorElmt=c}},SimileAjax.WindowManager._onBodyKeyUp=function(a,b){SimileAjax.WindowManager._dragging&&(17==b.keyCode||16==b.keyCode)&&(SimileAjax.WindowManager._draggingMode="",null!=SimileAjax.WindowManager._draggingModeIndicatorElmt&&(document.body.removeChild(SimileAjax.WindowManager._draggingModeIndicatorElmt),SimileAjax.WindowManager._draggingModeIndicatorElmt=null))},SimileAjax.WindowManager._onBodyMouseMove=function(a,b,c){if(null!=SimileAjax.WindowManager._draggedElement){var d=SimileAjax.WindowManager._draggedElementCallback,e=SimileAjax.WindowManager._lastCoords,f=b.clientX-e.x,g=b.clientY-e.y;if(SimileAjax.WindowManager._dragging)try{if(SimileAjax.WindowManager._lastCoords={x:b.clientX,y:b.clientY},"onDragBy"in d&&d.onDragBy(f,g),"_ghostElmt"in d){var h=d._ghostElmt;if(SimileAjax.WindowManager._ghostCoords.left+=f,SimileAjax.WindowManager._ghostCoords.top+=g,h.style.left=SimileAjax.WindowManager._ghostCoords.left+"px",h.style.top=SimileAjax.WindowManager._ghostCoords.top+"px",null!=SimileAjax.WindowManager._draggingModeIndicatorElmt){var i=SimileAjax.WindowManager._draggingModeIndicatorElmt;i.style.left=SimileAjax.WindowManager._ghostCoords.left-16+"px",i.style.top=SimileAjax.WindowManager._ghostCoords.top+"px"}if("droppable"in d&&d.droppable){var j=SimileAjax.DOM.getEventPageCoordinates(b),c=SimileAjax.DOM.hittest(j.x,j.y,[SimileAjax.WindowManager._ghostElmt,SimileAjax.WindowManager._dropTargetHighlightElement]);if(c=SimileAjax.WindowManager._findDropTarget(c),c!=SimileAjax.WindowManager._potentialDropTarget){null!=SimileAjax.WindowManager._dropTargetHighlightElement&&(document.body.removeChild(SimileAjax.WindowManager._dropTargetHighlightElement),SimileAjax.WindowManager._dropTargetHighlightElement=null,SimileAjax.WindowManager._potentialDropTarget=null);var k=!1;if(null!=c&&("canDropOn"in d&&!d.canDropOn(c)||"canDrop"in c&&!c.canDrop(SimileAjax.WindowManager._draggedElement)||(k=!0)),k){var l=4,m=SimileAjax.DOM.getPageCoordinates(c),n=document.createElement("div");n.style.border=l+"px solid yellow",n.style.backgroundColor="yellow",n.style.position="absolute",n.style.left=m.left+"px",n.style.top=m.top+"px",n.style.width=c.offsetWidth-2*l+"px",n.style.height=c.offsetHeight-2*l+"px",SimileAjax.Graphics.setOpacity(n,30),document.body.appendChild(n),SimileAjax.WindowManager._potentialDropTarget=c,SimileAjax.WindowManager._dropTargetHighlightElement=n}}}}}catch(o){SimileAjax.Debug.exception("WindowManager: Error handling mouse move",o),SimileAjax.WindowManager._cancelDragging()}else if(Math.abs(f)>5||Math.abs(g)>5)try{if("onDragStart"in d&&d.onDragStart(),"ghost"in d&&d.ghost){var p=SimileAjax.WindowManager._draggedElement;SimileAjax.WindowManager._ghostCoords=SimileAjax.DOM.getPageCoordinates(p),SimileAjax.WindowManager._ghostCoords.left+=f,SimileAjax.WindowManager._ghostCoords.top+=g;var h=p.cloneNode(!0);h.style.position="absolute",h.style.left=SimileAjax.WindowManager._ghostCoords.left+"px",h.style.top=SimileAjax.WindowManager._ghostCoords.top+"px",h.style.zIndex=1e3,SimileAjax.Graphics.setOpacity(h,50),document.body.appendChild(h),d._ghostElmt=h}SimileAjax.WindowManager._dragging=!0,SimileAjax.WindowManager._lastCoords={x:b.clientX,y:b.clientY},document.body.focus()}catch(o){SimileAjax.Debug.exception("WindowManager: Error handling mouse down",o),SimileAjax.WindowManager._cancelDragging()}return SimileAjax.DOM.cancelEvent(b),!1}},SimileAjax.WindowManager._onBodyMouseUp=function(a,b,c){if(null!=SimileAjax.WindowManager._draggedElement){try{if(SimileAjax.WindowManager._dragging){var d=SimileAjax.WindowManager._draggedElementCallback;if("onDragEnd"in d&&d.onDragEnd(),"droppable"in d&&d.droppable){var e=!1,c=SimileAjax.WindowManager._potentialDropTarget;null!=c&&("canDropOn"in d&&!d.canDropOn(c)||"canDrop"in c&&!c.canDrop(SimileAjax.WindowManager._draggedElement)||("onDropOn"in d&&d.onDropOn(c),c.ondrop(SimileAjax.WindowManager._draggedElement,SimileAjax.WindowManager._draggingMode),e=!0))}}}finally{SimileAjax.WindowManager._cancelDragging()}return SimileAjax.DOM.cancelEvent(b),!1}},SimileAjax.WindowManager._cancelDragging=function(){var a=SimileAjax.WindowManager._draggedElementCallback;if("_ghostElmt"in a){var b=a._ghostElmt;document.body.removeChild(b),delete a._ghostElmt}null!=SimileAjax.WindowManager._dropTargetHighlightElement&&(document.body.removeChild(SimileAjax.WindowManager._dropTargetHighlightElement),SimileAjax.WindowManager._dropTargetHighlightElement=null),null!=SimileAjax.WindowManager._draggingModeIndicatorElmt&&(document.body.removeChild(SimileAjax.WindowManager._draggingModeIndicatorElmt),SimileAjax.WindowManager._draggingModeIndicatorElmt=null),SimileAjax.WindowManager._draggedElement=null,SimileAjax.WindowManager._draggedElementCallback=null,SimileAjax.WindowManager._potentialDropTarget=null,SimileAjax.WindowManager._dropTargetHighlightElement=null,SimileAjax.WindowManager._lastCoords=null,SimileAjax.WindowManager._ghostCoords=null,SimileAjax.WindowManager._draggingMode="",SimileAjax.WindowManager._dragging=!1},SimileAjax.WindowManager._findDropTarget=function(a){for(;null!=a&&!("ondrop"in a&&"function"==typeof a.ondrop);)a=a.parentNode;return a},function(){if(!("Timeline"in window)){window.Timeline=new Object,window.Timeline.DateTime=window.SimileAjax.DateTime;var a="en";Timeline.urlPrefix="undefined"!=typeof TimelineUrlPrefix?TimelineUrlPrefix:"/dist/src/api/";{var b=a;("language"in navigator?navigator.language:navigator.browserLanguage).split(";")}Timeline.serverLocale=a,Timeline.clientLocale=b}}(),Timeline.version="2.3.0",Timeline.ajax_lib_version=SimileAjax.version,Timeline.display_version=Timeline.version+" (with Ajax lib "+Timeline.ajax_lib_version+")",Timeline.strings={},Timeline.HORIZONTAL=0,Timeline.VERTICAL=1,Timeline._defaultTheme=null,Timeline.getDefaultLocale=function(){return Timeline.clientLocale},Timeline.create=function(a,b,c,d){null==Timeline.timelines&&(Timeline.timelines=[]);var e=Timeline.timelines.length;Timeline.timelines[e]=null;var f=new Timeline._Impl(a,b,c,d,e);return Timeline.timelines[e]=f,f},Timeline.createBandInfo=function(a){var b="theme"in a?a.theme:Timeline.getDefaultTheme(),c="eventSource"in a?a.eventSource:null,d=new Timeline.LinearEther({centersOn:"date"in a?a.date:new Date,interval:SimileAjax.DateTime.gregorianUnitLengths[a.intervalUnit],pixelsPerInterval:a.intervalPixels,theme:b}),e=new Timeline.GregorianEtherPainter({unit:a.intervalUnit,multiple:"multiple"in a?a.multiple:1,theme:b,align:"align"in a?a.align:void 0}),f={showText:"showEventText"in a?a.showEventText:!0,theme:b};if("eventPainterParams"in a)for(var g in a.eventPainterParams)f[g]=a.eventPainterParams[g];"trackHeight"in a&&(f.trackHeight=a.trackHeight),"trackGap"in a&&(f.trackGap=a.trackGap);var h,i="overview"in a&&a.overview?"overview":"layout"in a?a.layout:"original";if("eventPainter"in a)h=new a.eventPainter(f);else switch(i){case"overview":h=new Timeline.OverviewEventPainter(f);break;case"detailed":h=new Timeline.DetailedEventPainter(f);break;default:h=new Timeline.OriginalEventPainter(f)}return{width:a.width,eventSource:c,timeZone:"timeZone"in a?a.timeZone:0,ether:d,etherPainter:e,eventPainter:h,theme:b,zoomIndex:"zoomIndex"in a?a.zoomIndex:0,zoomSteps:"zoomSteps"in a?a.zoomSteps:null}},Timeline.createHotZoneBandInfo=function(a){var b="theme"in a?a.theme:Timeline.getDefaultTheme(),c="eventSource"in a?a.eventSource:null,d=new Timeline.HotZoneEther({centersOn:"date"in a?a.date:new Date,interval:SimileAjax.DateTime.gregorianUnitLengths[a.intervalUnit],pixelsPerInterval:a.intervalPixels,zones:a.zones,theme:b}),e=new Timeline.HotZoneGregorianEtherPainter({unit:a.intervalUnit,zones:a.zones,theme:b,align:"align"in a?a.align:void 0}),f={showText:"showEventText"in a?a.showEventText:!0,theme:b};if("eventPainterParams"in a)for(var g in a.eventPainterParams)f[g]=a.eventPainterParams[g];"trackHeight"in a&&(f.trackHeight=a.trackHeight),"trackGap"in a&&(f.trackGap=a.trackGap);var h,i="overview"in a&&a.overview?"overview":"layout"in a?a.layout:"original";if("eventPainter"in a)h=new a.eventPainter(f);else switch(i){case"overview":h=new Timeline.OverviewEventPainter(f);break;case"detailed":h=new Timeline.DetailedEventPainter(f);break;default:h=new Timeline.OriginalEventPainter(f)}return{width:a.width,eventSource:c,timeZone:"timeZone"in a?a.timeZone:0,ether:d,etherPainter:e,eventPainter:h,theme:b,zoomIndex:"zoomIndex"in a?a.zoomIndex:0,zoomSteps:"zoomSteps"in a?a.zoomSteps:null}},Timeline.getDefaultTheme=function(){return null==Timeline._defaultTheme&&(Timeline._defaultTheme=Timeline.ClassicTheme.create(Timeline.getDefaultLocale())),Timeline._defaultTheme},Timeline.setDefaultTheme=function(a){Timeline._defaultTheme=a},Timeline.loadXML=function(a,b){var c=function(b){alert("Failed to load data xml from "+a+"\n"+b)},d=function(c){var d=c.responseXML;!d.documentElement&&c.responseStream&&d.load(c.responseStream),b(d,a)};SimileAjax.XmlHttp.get(a,c,d)},Timeline.loadJSON=function(url,f){var fError=function(a){alert("Failed to load json data from "+url+"\n"+a)},fDone=function(xmlhttp){f(eval("("+xmlhttp.responseText+")"),url)};SimileAjax.XmlHttp.get(url,fError,fDone)},Timeline.getTimelineFromID=function(a){return Timeline.timelines[a]},Timeline.writeVersion=function(a){document.getElementById(a).innerHTML=this.display_version},Timeline._Impl=function(a,b,c,d,e){SimileAjax.WindowManager.initialize(),this._containerDiv=a,this._bandInfos=b,this._orientation=null==c?Timeline.HORIZONTAL:c,this._unit=null!=d?d:SimileAjax.NativeDateUnit,this._starting=!0,this._autoResizing=!1,this.autoWidth=b&&b[0]&&b[0].theme&&b[0].theme.autoWidth,this.autoWidthAnimationTime=b&&b[0]&&b[0].theme&&b[0].theme.autoWidthAnimationTime,this.timelineID=e,this.timeline_start=b&&b[0]&&b[0].theme&&b[0].theme.timeline_start,this.timeline_stop=b&&b[0]&&b[0].theme&&b[0].theme.timeline_stop,this.timeline_at_start=!1,this.timeline_at_stop=!1,this._initialize()},Timeline._Impl.prototype.dispose=function(){for(var a=0;a<this._bands.length;a++)this._bands[a].dispose();this._bands=null,this._bandInfos=null,this._containerDiv.innerHTML="",Timeline.timelines[this.timelineID]=null},Timeline._Impl.prototype.getBandCount=function(){return this._bands.length},Timeline._Impl.prototype.getBand=function(a){return this._bands[a]},Timeline._Impl.prototype.finishedEventLoading=function(){this._autoWidthCheck(!0),this._starting=!1},Timeline._Impl.prototype.layout=function(){this._autoWidthCheck(!0),this._distributeWidths()},Timeline._Impl.prototype.paint=function(){for(var a=0;a<this._bands.length;a++)this._bands[a].paint()},Timeline._Impl.prototype.getDocument=function(){return this._containerDiv.ownerDocument},Timeline._Impl.prototype.addDiv=function(a){this._containerDiv.appendChild(a)},Timeline._Impl.prototype.removeDiv=function(a){this._containerDiv.removeChild(a)},Timeline._Impl.prototype.isHorizontal=function(){return this._orientation==Timeline.HORIZONTAL},Timeline._Impl.prototype.isVertical=function(){return this._orientation==Timeline.VERTICAL},Timeline._Impl.prototype.getPixelLength=function(){return this._orientation==Timeline.HORIZONTAL?this._containerDiv.offsetWidth:this._containerDiv.offsetHeight},Timeline._Impl.prototype.getPixelWidth=function(){return this._orientation==Timeline.VERTICAL?this._containerDiv.offsetWidth:this._containerDiv.offsetHeight},Timeline._Impl.prototype.getUnit=function(){return this._unit},Timeline._Impl.prototype.getWidthStyle=function(){return this._orientation==Timeline.HORIZONTAL?"height":"width"},Timeline._Impl.prototype.loadXML=function(a,b){var c=this,d=function(b){alert("Failed to load data xml from "+a+"\n"+b),c.hideLoadingMessage()},e=function(d){try{var e=d.responseXML;!e.documentElement&&d.responseStream&&e.load(d.responseStream),b(e,a)}finally{c.hideLoadingMessage()}};this.showLoadingMessage(),window.setTimeout(function(){SimileAjax.XmlHttp.get(a,d,e)},0)},Timeline._Impl.prototype.loadJSON=function(url,f){var tl=this,fError=function(a){alert("Failed to load json data from "+url+"\n"+a),tl.hideLoadingMessage()},fDone=function(xmlhttp){try{f(eval("("+xmlhttp.responseText+")"),url)}finally{tl.hideLoadingMessage()}};this.showLoadingMessage(),window.setTimeout(function(){SimileAjax.XmlHttp.get(url,fError,fDone)},0)},Timeline._Impl.prototype._autoWidthScrollListener=function(a){a.getTimeline()._autoWidthCheck(!1)},Timeline._Impl.prototype._autoWidthCheck=function(a){function b(){var a=d.getWidthStyle();if(e)d._containerDiv.style[a]=f+"px";else{d._autoResizing=!0;var b={};b[a]=f+"px",SimileAjax.jQuery(d._containerDiv).animate(b,d.autoWidthAnimationTime,"linear",function(){d._autoResizing=!1})}}function c(){var c=0,e=d.getPixelWidth();if(!d._autoResizing){for(var g=0;g<d._bands.length;g++)d._bands[g].checkAutoWidth(),c+=d._bandInfos[g].width;(c>e||a)&&(f=c,b(),d._distributeWidths())}}var d=this,e=d._starting,f=0;d.autoWidth&&c()},Timeline._Impl.prototype._initialize=function(){var a=this._containerDiv,b=a.ownerDocument;a.className=a.className.split(" ").concat("timeline-container").join(" ");var c=this.isHorizontal()?"horizontal":"vertical";for(a.className+=" timeline-"+c;a.firstChild;)a.removeChild(a.firstChild);var d=SimileAjax.Graphics.createTranslucentImage(Timeline.urlPrefix+(this.isHorizontal()?"images/copyright-vertical.png":"images/copyright.png"));d.className="timeline-copyright",d.title="Timeline copyright SIMILE - www.code.google.com/p/simile-widgets/",SimileAjax.DOM.registerEvent(d,"click",function(){window.location="http://code.google.com/p/simile-widgets/"}),a.appendChild(d),this._bands=[];for(var e=0;e<this._bandInfos.length;e++){var f=new Timeline._Band(this,this._bandInfos[e],e);this._bands.push(f)}this._distributeWidths();for(var e=0;e<this._bandInfos.length;e++){var g=this._bandInfos[e];"syncWith"in g&&this._bands[e].setSyncWithBand(this._bands[g.syncWith],"highlight"in g?g.highlight:!1)}if(this.autoWidth)for(var e=0;e<this._bands.length;e++)this._bands[e].addOnScrollListener(this._autoWidthScrollListener);var h=SimileAjax.Graphics.createMessageBubble(b);h.containerDiv.className="timeline-message-container",a.appendChild(h.containerDiv),h.contentDiv.className="timeline-message",h.contentDiv.innerHTML="<img src='"+Timeline.urlPrefix+"images/progress-running.gif' /> Loading...",this.showLoadingMessage=function(){h.containerDiv.style.display="block"},this.hideLoadingMessage=function(){h.containerDiv.style.display="none"}},Timeline._Impl.prototype._distributeWidths=function(){for(var a=this.getPixelLength(),b=this.getPixelWidth(),c=0,d=0;d<this._bands.length;d++){var e,f=this._bands[d],g=this._bandInfos[d],h=g.width;if("string"==typeof h){var i=h.indexOf("%");if(i>0){var j=parseInt(h.substr(0,i));e=Math.round(j*b/100)}else e=parseInt(h)}else e=h;f.setBandShiftAndWidth(c,e),f.setViewLength(a),c+=e}},Timeline._Impl.prototype.shiftOK=function(a,b){var c=b>0,d=0>b;if(c&&null==this.timeline_start||d&&null==this.timeline_stop||0==b)return!0;for(var e=!1,f=0;f<this._bands.length&&!e;f++)e=this._bands[f].busy();if(e)return!0;if(c&&this.timeline_at_start||d&&this.timeline_at_stop)return!1;for(var g=!1,f=0;f<this._bands.length&&!g;f++){var h=this._bands[f];g=c?(f==a?h.getMinVisibleDateAfterDelta(b):h.getMinVisibleDate())>=this.timeline_start:(f==a?h.getMaxVisibleDateAfterDelta(b):h.getMaxVisibleDate())<=this.timeline_stop}return c?(this.timeline_at_start=!g,this.timeline_at_stop=!1):(this.timeline_at_stop=!g,this.timeline_at_start=!1),g},Timeline._Impl.prototype.zoom=function(a,b,c,d){var e=new RegExp("^timeline-band-([0-9]+)$"),f=null,g=e.exec(d.id);g&&(f=parseInt(g[1])),null!=f&&this._bands[f].zoom(a,b,c,d),this.paint()},Timeline._Band=function(a,b,c){a.autoWidth&&"string"==typeof b.width&&(b.width=b.width.indexOf("%")>-1?0:parseInt(b.width)),this._timeline=a,this._bandInfo=b,this._index=c,this._locale="locale"in b?b.locale:Timeline.getDefaultLocale(),this._timeZone="timeZone"in b?b.timeZone:0,this._labeller="labeller"in b?b.labeller:"createLabeller"in a.getUnit()?a.getUnit().createLabeller(this._locale,this._timeZone):new Timeline.GregorianDateLabeller(this._locale,this._timeZone),this._theme=b.theme,this._zoomIndex="zoomIndex"in b?b.zoomIndex:0,this._zoomSteps="zoomSteps"in b?b.zoomSteps:null,this._dragging=!1,this._changing=!1,this._originalScrollSpeed=5,this._scrollSpeed=this._originalScrollSpeed,this._onScrollListeners=[];var d=this;this._syncWithBand=null,this._syncWithBandHandler=function(){d._onHighlightBandScroll()},this._selectorListener=function(){d._onHighlightBandScroll()};var e=this._timeline.getDocument().createElement("div");e.className="timeline-band-input",this._timeline.addDiv(e),this._keyboardInput=document.createElement("input"),
this._keyboardInput.type="text",e.appendChild(this._keyboardInput),SimileAjax.DOM.registerEventWithObject(this._keyboardInput,"keydown",this,"_onKeyDown"),SimileAjax.DOM.registerEventWithObject(this._keyboardInput,"keyup",this,"_onKeyUp"),this._div=this._timeline.getDocument().createElement("div"),this._div.id="timeline-band-"+c,this._div.className="timeline-band timeline-band-"+c,this._timeline.addDiv(this._div),SimileAjax.DOM.registerEventWithObject(this._div,"mousedown",this,"_onMouseDown"),SimileAjax.DOM.registerEventWithObject(this._div,"mousemove",this,"_onMouseMove"),SimileAjax.DOM.registerEventWithObject(this._div,"mouseup",this,"_onMouseUp"),SimileAjax.DOM.registerEventWithObject(this._div,"mouseout",this,"_onMouseOut"),SimileAjax.DOM.registerEventWithObject(this._div,"dblclick",this,"_onDblClick");var f=null!=this._theme?this._theme.mouseWheel:"scroll";("zoom"===f||"scroll"===f||this._zoomSteps)&&(SimileAjax.Platform.browser.isFirefox?SimileAjax.DOM.registerEventWithObject(this._div,"DOMMouseScroll",this,"_onMouseScroll"):SimileAjax.DOM.registerEventWithObject(this._div,"mousewheel",this,"_onMouseScroll")),this._innerDiv=this._timeline.getDocument().createElement("div"),this._innerDiv.className="timeline-band-inner",this._div.appendChild(this._innerDiv),this._ether=b.ether,b.ether.initialize(this,a),this._etherPainter=b.etherPainter,b.etherPainter.initialize(this,a),this._eventSource=b.eventSource,this._eventSource&&(this._eventListener={onAddMany:function(){d._onAddMany()},onClear:function(){d._onClear()}},this._eventSource.addListener(this._eventListener)),this._eventPainter=b.eventPainter,this._eventTracksNeeded=0,this._eventTrackIncrement=0,b.eventPainter.initialize(this,a),this._decorators="decorators"in b?b.decorators:[];for(var g=0;g<this._decorators.length;g++)this._decorators[g].initialize(this,a)},Timeline._Band.SCROLL_MULTIPLES=5,Timeline._Band.prototype.dispose=function(){this.closeBubble(),this._eventSource&&(this._eventSource.removeListener(this._eventListener),this._eventListener=null,this._eventSource=null),this._timeline=null,this._bandInfo=null,this._labeller=null,this._ether=null,this._etherPainter=null,this._eventPainter=null,this._decorators=null,this._onScrollListeners=null,this._syncWithBandHandler=null,this._selectorListener=null,this._div=null,this._innerDiv=null,this._keyboardInput=null},Timeline._Band.prototype.addOnScrollListener=function(a){this._onScrollListeners.push(a)},Timeline._Band.prototype.removeOnScrollListener=function(a){for(var b=0;b<this._onScrollListeners.length;b++)if(this._onScrollListeners[b]==a){this._onScrollListeners.splice(b,1);break}},Timeline._Band.prototype.setSyncWithBand=function(a,b){this._syncWithBand&&this._syncWithBand.removeOnScrollListener(this._syncWithBandHandler),this._syncWithBand=a,this._syncWithBand.addOnScrollListener(this._syncWithBandHandler),this._highlight=b,this._positionHighlight()},Timeline._Band.prototype.getLocale=function(){return this._locale},Timeline._Band.prototype.getTimeZone=function(){return this._timeZone},Timeline._Band.prototype.getLabeller=function(){return this._labeller},Timeline._Band.prototype.getIndex=function(){return this._index},Timeline._Band.prototype.getEther=function(){return this._ether},Timeline._Band.prototype.getEtherPainter=function(){return this._etherPainter},Timeline._Band.prototype.getEventSource=function(){return this._eventSource},Timeline._Band.prototype.getEventPainter=function(){return this._eventPainter},Timeline._Band.prototype.getTimeline=function(){return this._timeline},Timeline._Band.prototype.updateEventTrackInfo=function(a,b){this._eventTrackIncrement=b,a>this._eventTracksNeeded&&(this._eventTracksNeeded=a)},Timeline._Band.prototype.checkAutoWidth=function(){if(this._timeline.autoWidth){var a="overview"==this._eventPainter.getType(),b=a?this._theme.event.overviewTrack.autoWidthMargin:this._theme.event.track.autoWidthMargin,c=Math.ceil((this._eventTracksNeeded+b)*this._eventTrackIncrement);c+=a?this._theme.event.overviewTrack.offset:this._theme.event.track.offset;var d=this._bandInfo;c!=d.width&&(d.width=c)}},Timeline._Band.prototype.layout=function(){this.paint()},Timeline._Band.prototype.paint=function(){this._etherPainter.paint(),this._paintDecorators(),this._paintEvents()},Timeline._Band.prototype.softLayout=function(){this.softPaint()},Timeline._Band.prototype.softPaint=function(){this._etherPainter.softPaint(),this._softPaintDecorators(),this._softPaintEvents()},Timeline._Band.prototype.setBandShiftAndWidth=function(a,b){var c=this._keyboardInput.parentNode,d=a+Math.floor(b/2);this._timeline.isHorizontal()?(this._div.style.top=a+"px",this._div.style.height=b+"px",c.style.top=d+"px",c.style.left="-1em"):(this._div.style.left=a+"px",this._div.style.width=b+"px",c.style.left=d+"px",c.style.top="-1em")},Timeline._Band.prototype.getViewWidth=function(){return this._timeline.isHorizontal()?this._div.offsetHeight:this._div.offsetWidth},Timeline._Band.prototype.setViewLength=function(a){this._viewLength=a,this._recenterDiv(),this._onChanging()},Timeline._Band.prototype.getViewLength=function(){return this._viewLength},Timeline._Band.prototype.getTotalViewLength=function(){return Timeline._Band.SCROLL_MULTIPLES*this._viewLength},Timeline._Band.prototype.getViewOffset=function(){return this._viewOffset},Timeline._Band.prototype.getMinDate=function(){return this._ether.pixelOffsetToDate(this._viewOffset)},Timeline._Band.prototype.getMaxDate=function(){return this._ether.pixelOffsetToDate(this._viewOffset+Timeline._Band.SCROLL_MULTIPLES*this._viewLength)},Timeline._Band.prototype.getMinVisibleDate=function(){return this._ether.pixelOffsetToDate(0)},Timeline._Band.prototype.getMinVisibleDateAfterDelta=function(a){return this._ether.pixelOffsetToDate(a)},Timeline._Band.prototype.getMaxVisibleDate=function(){return this._ether.pixelOffsetToDate(this._viewLength)},Timeline._Band.prototype.getMaxVisibleDateAfterDelta=function(a){return this._ether.pixelOffsetToDate(this._viewLength+a)},Timeline._Band.prototype.getCenterVisibleDate=function(){return this._ether.pixelOffsetToDate(this._viewLength/2)},Timeline._Band.prototype.setMinVisibleDate=function(a){this._changing||this._moveEther(Math.round(-this._ether.dateToPixelOffset(a)))},Timeline._Band.prototype.setMaxVisibleDate=function(a){this._changing||this._moveEther(Math.round(this._viewLength-this._ether.dateToPixelOffset(a)))},Timeline._Band.prototype.setCenterVisibleDate=function(a){this._changing||this._moveEther(Math.round(this._viewLength/2-this._ether.dateToPixelOffset(a)))},Timeline._Band.prototype.dateToPixelOffset=function(a){return this._ether.dateToPixelOffset(a)-this._viewOffset},Timeline._Band.prototype.pixelOffsetToDate=function(a){return this._ether.pixelOffsetToDate(a+this._viewOffset)},Timeline._Band.prototype.createLayerDiv=function(a,b){var c=this._timeline.getDocument().createElement("div");c.className="timeline-band-layer"+("string"==typeof b?" "+b:""),c.style.zIndex=a,this._innerDiv.appendChild(c);var d=this._timeline.getDocument().createElement("div");return d.className="timeline-band-layer-inner",d.style.cursor=SimileAjax.Platform.browser.isIE?"move":"-moz-grab",c.appendChild(d),d},Timeline._Band.prototype.removeLayerDiv=function(a){this._innerDiv.removeChild(a.parentNode)},Timeline._Band.prototype.scrollToCenter=function(a,b){var c=this._ether.dateToPixelOffset(a);c<-this._viewLength/2?this.setCenterVisibleDate(this.pixelOffsetToDate(c+this._viewLength)):c>3*this._viewLength/2&&this.setCenterVisibleDate(this.pixelOffsetToDate(c-this._viewLength)),this._autoScroll(Math.round(this._viewLength/2-this._ether.dateToPixelOffset(a)),b)},Timeline._Band.prototype.showBubbleForEvent=function(a){var b=this.getEventSource().getEvent(a);if(b){var c=this;this.scrollToCenter(b.getStart(),function(){c._eventPainter.showBubble(b)})}},Timeline._Band.prototype.zoom=function(a,b){if(this._zoomSteps){b+=this._viewOffset;var c=this._ether.pixelOffsetToDate(b),d=this._ether.zoom(a);this._etherPainter.zoom(d),this._moveEther(Math.round(-this._ether.dateToPixelOffset(c))),this._moveEther(b)}},Timeline._Band.prototype._onMouseDown=function(a,b){this.closeBubble(),this._dragging=!0,this._dragX=b.clientX,this._dragY=b.clientY},Timeline._Band.prototype._onMouseMove=function(a,b){if(this._dragging){var c=b.clientX-this._dragX,d=b.clientY-this._dragY;this._dragX=b.clientX,this._dragY=b.clientY,this._moveEther(this._timeline.isHorizontal()?c:d),this._positionHighlight()}},Timeline._Band.prototype._onMouseUp=function(){this._dragging=!1,this._keyboardInput.focus()},Timeline._Band.prototype._onMouseOut=function(a,b){var c=SimileAjax.DOM.getEventRelativeCoordinates(b,a);c.x+=this._viewOffset,(c.x<0||c.x>a.offsetWidth||c.y<0||c.y>a.offsetHeight)&&(this._dragging=!1)},Timeline._Band.prototype._onMouseScroll=function(a,b){var c=new Date;if(c=c.getTime(),!this._lastScrollTime||c-this._lastScrollTime>50){this._lastScrollTime=c;var d=0;b.wheelDelta?d=b.wheelDelta/120:b.detail&&(d=-b.detail/3);var e=this._theme.mouseWheel;if(this._zoomSteps||"zoom"===e){var f=SimileAjax.DOM.getEventRelativeCoordinates(b,a);if(0!=d){var g;d>0&&(g=!0),0>d&&(g=!1),this._timeline.zoom(g,f.x,f.y,a)}}else if("scroll"===e){var h=50*(0>d?-1:1);this._moveEther(h)}}b.stopPropagation&&b.stopPropagation(),b.cancelBubble=!0,b.preventDefault&&b.preventDefault(),b.returnValue=!1},Timeline._Band.prototype._onDblClick=function(a,b){var c=SimileAjax.DOM.getEventRelativeCoordinates(b,a),d=c.x-(this._viewLength/2-this._viewOffset);this._autoScroll(-d)},Timeline._Band.prototype._onKeyDown=function(a,b){if(!this._dragging){switch(b.keyCode){case 27:break;case 37:case 38:this._scrollSpeed=Math.min(50,Math.abs(1.05*this._scrollSpeed)),this._moveEther(this._scrollSpeed);break;case 39:case 40:this._scrollSpeed=-Math.min(50,Math.abs(1.05*this._scrollSpeed)),this._moveEther(this._scrollSpeed);break;default:return!0}return this.closeBubble(),SimileAjax.DOM.cancelEvent(b),!1}return!0},Timeline._Band.prototype._onKeyUp=function(a,b){if(!this._dragging){switch(this._scrollSpeed=this._originalScrollSpeed,b.keyCode){case 35:this.setCenterVisibleDate(this._eventSource.getLatestDate());break;case 36:this.setCenterVisibleDate(this._eventSource.getEarliestDate());break;case 33:this._autoScroll(this._timeline.getPixelLength());break;case 34:this._autoScroll(-this._timeline.getPixelLength());break;default:return!0}return this.closeBubble(),SimileAjax.DOM.cancelEvent(b),!1}return!0},Timeline._Band.prototype._autoScroll=function(a,b){var c=this,d=SimileAjax.Graphics.createAnimation(function(a,b){c._moveEther(b)},0,a,1e3,b);d.run()},Timeline._Band.prototype._moveEther=function(a){this.closeBubble(),this._timeline.shiftOK(this._index,a)&&(this._viewOffset+=a,this._ether.shiftPixels(-a),this._timeline.isHorizontal()?this._div.style.left=this._viewOffset+"px":this._div.style.top=this._viewOffset+"px",this._viewOffset>.5*-this._viewLength||this._viewOffset<-this._viewLength*(Timeline._Band.SCROLL_MULTIPLES-1.5)?this._recenterDiv():this.softLayout(),this._onChanging())},Timeline._Band.prototype._onChanging=function(){this._changing=!0,this._fireOnScroll(),this._setSyncWithBandDate(),this._changing=!1},Timeline._Band.prototype.busy=function(){return this._changing},Timeline._Band.prototype._fireOnScroll=function(){for(var a=0;a<this._onScrollListeners.length;a++)this._onScrollListeners[a](this)},Timeline._Band.prototype._setSyncWithBandDate=function(){if(this._syncWithBand){var a=this._ether.pixelOffsetToDate(this.getViewLength()/2);this._syncWithBand.setCenterVisibleDate(a)}},Timeline._Band.prototype._onHighlightBandScroll=function(){if(this._syncWithBand){var a=this._syncWithBand.getCenterVisibleDate(),b=this._ether.dateToPixelOffset(a);this._moveEther(Math.round(this._viewLength/2-b)),this._highlight&&this._etherPainter.setHighlight(this._syncWithBand.getMinVisibleDate(),this._syncWithBand.getMaxVisibleDate())}},Timeline._Band.prototype._onAddMany=function(){this._paintEvents()},Timeline._Band.prototype._onClear=function(){this._paintEvents()},Timeline._Band.prototype._positionHighlight=function(){if(this._syncWithBand){var a=this._syncWithBand.getMinVisibleDate(),b=this._syncWithBand.getMaxVisibleDate();this._highlight&&this._etherPainter.setHighlight(a,b)}},Timeline._Band.prototype._recenterDiv=function(){this._viewOffset=-this._viewLength*(Timeline._Band.SCROLL_MULTIPLES-1)/2,this._timeline.isHorizontal()?(this._div.style.left=this._viewOffset+"px",this._div.style.width=Timeline._Band.SCROLL_MULTIPLES*this._viewLength+"px"):(this._div.style.top=this._viewOffset+"px",this._div.style.height=Timeline._Band.SCROLL_MULTIPLES*this._viewLength+"px"),this.layout()},Timeline._Band.prototype._paintEvents=function(){this._eventPainter.paint()},Timeline._Band.prototype._softPaintEvents=function(){this._eventPainter.softPaint()},Timeline._Band.prototype._paintDecorators=function(){for(var a=0;a<this._decorators.length;a++)this._decorators[a].paint()},Timeline._Band.prototype._softPaintDecorators=function(){for(var a=0;a<this._decorators.length;a++)this._decorators[a].softPaint()},Timeline._Band.prototype.closeBubble=function(){SimileAjax.WindowManager.cancelPopups()},Timeline.ClassicTheme=new Object,Timeline.ClassicTheme.implementations=[],Timeline.ClassicTheme.create=function(a){null==a&&(a=Timeline.getDefaultLocale());var b=Timeline.ClassicTheme.implementations[a];return null==b&&(b=Timeline.ClassicTheme._Impl),new b},Timeline.ClassicTheme._Impl=function(){this.firstDayOfWeek=0,this.autoWidth=!1,this.autoWidthAnimationTime=500,this.timeline_start=null,this.timeline_stop=null,this.ether={backgroundColors:[],highlightOpacity:50,interval:{line:{show:!0,opacity:25},weekend:{opacity:30},marker:{hAlign:"Bottom",vAlign:"Right"}}},this.event={track:{height:10,gap:2,offset:2,autoWidthMargin:1.5},overviewTrack:{offset:20,tickHeight:6,height:2,gap:1,autoWidthMargin:5},tape:{height:4},instant:{icon:Timeline.urlPrefix+"images/dull-blue-circle.png",iconWidth:10,iconHeight:10,impreciseOpacity:20,impreciseIconMargin:3},duration:{impreciseOpacity:20},label:{backgroundOpacity:50,offsetFromLine:3},highlightColors:["#FFFF00","#FFC000","#FF0000","#0000FF"],highlightLabelBackground:!1,bubble:{width:250,maxHeight:0,titleStyler:function(a){a.className="timeline-event-bubble-title"},bodyStyler:function(a){a.className="timeline-event-bubble-body"},imageStyler:function(a){a.className="timeline-event-bubble-image"},wikiStyler:function(a){a.className="timeline-event-bubble-wiki"},timeStyler:function(a){a.className="timeline-event-bubble-time"}}},this.mouseWheel="scroll"},Timeline.LinearEther=function(a){this._params=a,this._interval=a.interval,this._pixelsPerInterval=a.pixelsPerInterval},Timeline.LinearEther.prototype.initialize=function(a,b){this._band=a,this._timeline=b,this._unit=b.getUnit(),"startsOn"in this._params?this._start=this._unit.parseFromObject(this._params.startsOn):"endsOn"in this._params?(this._start=this._unit.parseFromObject(this._params.endsOn),this.shiftPixels(-this._timeline.getPixelLength())):"centersOn"in this._params?(this._start=this._unit.parseFromObject(this._params.centersOn),this.shiftPixels(-this._timeline.getPixelLength()/2)):(this._start=this._unit.makeDefaultValue(),this.shiftPixels(-this._timeline.getPixelLength()/2))},Timeline.LinearEther.prototype.setDate=function(a){this._start=this._unit.cloneValue(a)},Timeline.LinearEther.prototype.shiftPixels=function(a){var b=this._interval*a/this._pixelsPerInterval;this._start=this._unit.change(this._start,b)},Timeline.LinearEther.prototype.dateToPixelOffset=function(a){var b=this._unit.compare(a,this._start);return this._pixelsPerInterval*b/this._interval},Timeline.LinearEther.prototype.pixelOffsetToDate=function(a){var b=a*this._interval/this._pixelsPerInterval;return this._unit.change(this._start,b)},Timeline.LinearEther.prototype.zoom=function(a){var b=0,c=this._band._zoomIndex,d=c;return a&&c>0&&(d=c-1),!a&&c<this._band._zoomSteps.length-1&&(d=c+1),this._band._zoomIndex=d,this._interval=SimileAjax.DateTime.gregorianUnitLengths[this._band._zoomSteps[d].unit],this._pixelsPerInterval=this._band._zoomSteps[d].pixelsPerInterval,b=this._band._zoomSteps[d].unit-this._band._zoomSteps[c].unit},Timeline.HotZoneEther=function(a){this._params=a,this._interval=a.interval,this._pixelsPerInterval=a.pixelsPerInterval,this._theme=a.theme},Timeline.HotZoneEther.prototype.initialize=function(a,b){this._band=a,this._timeline=b,this._unit=b.getUnit(),this._zones=[{startTime:Number.NEGATIVE_INFINITY,endTime:Number.POSITIVE_INFINITY,magnify:1}];for(var c=this._params,d=0;d<c.zones.length;d++)for(var e=c.zones[d],f=this._unit.parseFromObject(e.start),g=this._unit.parseFromObject(e.end),h=0;h<this._zones.length&&this._unit.compare(g,f)>0;h++){var i=this._zones[h];this._unit.compare(f,i.endTime)<0&&(this._unit.compare(f,i.startTime)>0&&(this._zones.splice(h,0,{startTime:i.startTime,endTime:f,magnify:i.magnify}),h++,i.startTime=f),this._unit.compare(g,i.endTime)<0?(this._zones.splice(h,0,{startTime:f,endTime:g,magnify:e.magnify*i.magnify}),h++,i.startTime=g,f=g):(i.magnify*=e.magnify,f=i.endTime))}"startsOn"in this._params?this._start=this._unit.parseFromObject(this._params.startsOn):"endsOn"in this._params?(this._start=this._unit.parseFromObject(this._params.endsOn),this.shiftPixels(-this._timeline.getPixelLength())):"centersOn"in this._params?(this._start=this._unit.parseFromObject(this._params.centersOn),this.shiftPixels(-this._timeline.getPixelLength()/2)):(this._start=this._unit.makeDefaultValue(),this.shiftPixels(-this._timeline.getPixelLength()/2))},Timeline.HotZoneEther.prototype.setDate=function(a){this._start=this._unit.cloneValue(a)},Timeline.HotZoneEther.prototype.shiftPixels=function(a){this._start=this.pixelOffsetToDate(a)},Timeline.HotZoneEther.prototype.dateToPixelOffset=function(a){return this._dateDiffToPixelOffset(this._start,a)},Timeline.HotZoneEther.prototype.pixelOffsetToDate=function(a){return this._pixelOffsetToDate(a,this._start)},Timeline.HotZoneEther.prototype.zoom=function(a){var b=0,c=this._band._zoomIndex,d=c;return a&&c>0&&(d=c-1),!a&&c<this._band._zoomSteps.length-1&&(d=c+1),this._band._zoomIndex=d,this._interval=SimileAjax.DateTime.gregorianUnitLengths[this._band._zoomSteps[d].unit],this._pixelsPerInterval=this._band._zoomSteps[d].pixelsPerInterval,b=this._band._zoomSteps[d].unit-this._band._zoomSteps[c].unit},Timeline.HotZoneEther.prototype._dateDiffToPixelOffset=function(a,b){var c=this._getScale(),d=a,e=b,f=0;if(this._unit.compare(d,e)<0){for(var g=0;g<this._zones.length&&!(this._unit.compare(d,this._zones[g].endTime)<0);)g++;for(;this._unit.compare(d,e)<0;){var h=this._zones[g],i=this._unit.earlier(e,h.endTime);f+=this._unit.compare(i,d)/(c/h.magnify),d=i,g++}}else{for(var g=this._zones.length-1;g>=0&&!(this._unit.compare(d,this._zones[g].startTime)>0);)g--;for(;this._unit.compare(d,e)>0;){var h=this._zones[g],i=this._unit.later(e,h.startTime);f+=this._unit.compare(i,d)/(c/h.magnify),d=i,g--}}return f},Timeline.HotZoneEther.prototype._pixelOffsetToDate=function(a,b){var c=this._getScale(),d=b;if(a>0){for(var e=0;e<this._zones.length&&!(this._unit.compare(d,this._zones[e].endTime)<0);)e++;for(;a>0;){var f=this._zones[e],g=c/f.magnify;if(f.endTime==Number.POSITIVE_INFINITY)d=this._unit.change(d,a*g),a=0;else{var h=this._unit.compare(f.endTime,d)/g;h>a?(d=this._unit.change(d,a*g),a=0):(d=f.endTime,a-=h)}e++}}else{for(var e=this._zones.length-1;e>=0&&!(this._unit.compare(d,this._zones[e].startTime)>0);)e--;for(a=-a;a>0;){var f=this._zones[e],g=c/f.magnify;if(f.startTime==Number.NEGATIVE_INFINITY)d=this._unit.change(d,-a*g),a=0;else{var h=this._unit.compare(d,f.startTime)/g;h>a?(d=this._unit.change(d,-a*g),a=0):(d=f.startTime,a-=h)}e--}}return d},Timeline.HotZoneEther.prototype._getScale=function(){return this._interval/this._pixelsPerInterval},Timeline.GregorianEtherPainter=function(a){this._params=a,this._theme=a.theme,this._unit=a.unit,this._multiple="multiple"in a?a.multiple:1},Timeline.GregorianEtherPainter.prototype.initialize=function(a,b){this._band=a,this._timeline=b,this._backgroundLayer=a.createLayerDiv(0),this._backgroundLayer.setAttribute("name","ether-background"),this._backgroundLayer.className="timeline-ether-bg",this._markerLayer=null,this._lineLayer=null;var c="align"in this._params&&void 0!=this._params.align?this._params.align:this._theme.ether.interval.marker[b.isHorizontal()?"hAlign":"vAlign"],d="showLine"in this._params?this._params.showLine:this._theme.ether.interval.line.show;this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,this._band,this._theme,c,d),this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)},Timeline.GregorianEtherPainter.prototype.setHighlight=function(a,b){this._highlight.position(a,b)},Timeline.GregorianEtherPainter.prototype.paint=function(){this._markerLayer&&this._band.removeLayerDiv(this._markerLayer),this._markerLayer=this._band.createLayerDiv(100),this._markerLayer.setAttribute("name","ether-markers"),this._markerLayer.style.display="none",this._lineLayer&&this._band.removeLayerDiv(this._lineLayer),this._lineLayer=this._band.createLayerDiv(1),this._lineLayer.setAttribute("name","ether-lines"),this._lineLayer.style.display="none";var a=this._band.getMinDate(),b=this._band.getMaxDate(),c=this._band.getTimeZone(),d=this._band.getLabeller();SimileAjax.DateTime.roundDownToInterval(a,this._unit,c,this._multiple,this._theme.firstDayOfWeek);for(var e=this,f=function(a){for(var b=0;b<e._multiple;b++)SimileAjax.DateTime.incrementByInterval(a,e._unit)};a.getTime()<b.getTime();)this._intervalMarkerLayout.createIntervalMarker(a,d,this._unit,this._markerLayer,this._lineLayer),f(a);this._markerLayer.style.display="block",this._lineLayer.style.display="block"},Timeline.GregorianEtherPainter.prototype.softPaint=function(){},Timeline.GregorianEtherPainter.prototype.zoom=function(a){0!=a&&(this._unit+=a)},Timeline.HotZoneGregorianEtherPainter=function(a){this._params=a,this._theme=a.theme,this._zones=[{startTime:Number.NEGATIVE_INFINITY,endTime:Number.POSITIVE_INFINITY,unit:a.unit,multiple:1}];for(var b=0;b<a.zones.length;b++)for(var c=a.zones[b],d=SimileAjax.DateTime.parseGregorianDateTime(c.start).getTime(),e=SimileAjax.DateTime.parseGregorianDateTime(c.end).getTime(),f=0;f<this._zones.length&&e>d;f++){var g=this._zones[f];d<g.endTime&&(d>g.startTime&&(this._zones.splice(f,0,{startTime:g.startTime,endTime:d,unit:g.unit,multiple:g.multiple}),f++,g.startTime=d),e<g.endTime?(this._zones.splice(f,0,{startTime:d,endTime:e,unit:c.unit,multiple:c.multiple?c.multiple:1}),f++,g.startTime=e,d=e):(g.multiple=c.multiple,g.unit=c.unit,d=g.endTime))}},Timeline.HotZoneGregorianEtherPainter.prototype.initialize=function(a,b){this._band=a,this._timeline=b,this._backgroundLayer=a.createLayerDiv(0),this._backgroundLayer.setAttribute("name","ether-background"),this._backgroundLayer.className="timeline-ether-bg",this._markerLayer=null,this._lineLayer=null;var c="align"in this._params&&void 0!=this._params.align?this._params.align:this._theme.ether.interval.marker[b.isHorizontal()?"hAlign":"vAlign"],d="showLine"in this._params?this._params.showLine:this._theme.ether.interval.line.show;this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,this._band,this._theme,c,d),this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)},Timeline.HotZoneGregorianEtherPainter.prototype.setHighlight=function(a,b){this._highlight.position(a,b)},Timeline.HotZoneGregorianEtherPainter.prototype.paint=function(){this._markerLayer&&this._band.removeLayerDiv(this._markerLayer),this._markerLayer=this._band.createLayerDiv(100),this._markerLayer.setAttribute("name","ether-markers"),this._markerLayer.style.display="none",this._lineLayer&&this._band.removeLayerDiv(this._lineLayer),this._lineLayer=this._band.createLayerDiv(1),this._lineLayer.setAttribute("name","ether-lines"),this._lineLayer.style.display="none";for(var a=this._band.getMinDate(),b=this._band.getMaxDate(),c=this._band.getTimeZone(),d=this._band.getLabeller(),e=function(a,b){for(var c=0;c<b.multiple;c++)SimileAjax.DateTime.incrementByInterval(a,b.unit)},f=0;f<this._zones.length&&!(a.getTime()<this._zones[f].endTime);)f++;for(var g=this._zones.length-1;g>=0&&!(b.getTime()>this._zones[g].startTime);)g--;for(var h=f;g>=h;h++){var i=this._zones[h],j=new Date(Math.max(a.getTime(),i.startTime)),k=new Date(Math.min(b.getTime(),i.endTime));for(SimileAjax.DateTime.roundDownToInterval(j,i.unit,c,i.multiple,this._theme.firstDayOfWeek),SimileAjax.DateTime.roundUpToInterval(k,i.unit,c,i.multiple,this._theme.firstDayOfWeek);j.getTime()<k.getTime();)this._intervalMarkerLayout.createIntervalMarker(j,d,i.unit,this._markerLayer,this._lineLayer),e(j,i)}this._markerLayer.style.display="block",this._lineLayer.style.display="block"},Timeline.HotZoneGregorianEtherPainter.prototype.softPaint=function(){},Timeline.HotZoneGregorianEtherPainter.prototype.zoom=function(a){if(0!=a)for(var b=0;b<this._zones.length;++b)this._zones[b]&&(this._zones[b].unit+=a)},Timeline.YearCountEtherPainter=function(a){this._params=a,this._theme=a.theme,this._startDate=SimileAjax.DateTime.parseGregorianDateTime(a.startDate),this._multiple="multiple"in a?a.multiple:1},Timeline.YearCountEtherPainter.prototype.initialize=function(a,b){this._band=a,this._timeline=b,this._backgroundLayer=a.createLayerDiv(0),this._backgroundLayer.setAttribute("name","ether-background"),this._backgroundLayer.className="timeline-ether-bg",this._markerLayer=null,this._lineLayer=null;var c="align"in this._params?this._params.align:this._theme.ether.interval.marker[b.isHorizontal()?"hAlign":"vAlign"],d="showLine"in this._params?this._params.showLine:this._theme.ether.interval.line.show;this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,this._band,this._theme,c,d),this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)},Timeline.YearCountEtherPainter.prototype.setHighlight=function(a,b){this._highlight.position(a,b)},Timeline.YearCountEtherPainter.prototype.paint=function(){this._markerLayer&&this._band.removeLayerDiv(this._markerLayer),this._markerLayer=this._band.createLayerDiv(100),this._markerLayer.setAttribute("name","ether-markers"),this._markerLayer.style.display="none",this._lineLayer&&this._band.removeLayerDiv(this._lineLayer),this._lineLayer=this._band.createLayerDiv(1),this._lineLayer.setAttribute("name","ether-lines"),this._lineLayer.style.display="none";var a=new Date(this._startDate.getTime()),b=this._band.getMaxDate(),c=this._band.getMinDate().getUTCFullYear()-this._startDate.getUTCFullYear();a.setUTCFullYear(this._band.getMinDate().getUTCFullYear()-c%this._multiple);for(var d=this,e=function(a){for(var b=0;b<d._multiple;b++)SimileAjax.DateTime.incrementByInterval(a,SimileAjax.DateTime.YEAR)},f={labelInterval:function(a){var b=a.getUTCFullYear()-d._startDate.getUTCFullYear();return{text:b,emphasized:0==b}}};a.getTime()<b.getTime();)this._intervalMarkerLayout.createIntervalMarker(a,f,SimileAjax.DateTime.YEAR,this._markerLayer,this._lineLayer),e(a);this._markerLayer.style.display="block",this._lineLayer.style.display="block"},Timeline.YearCountEtherPainter.prototype.softPaint=function(){},Timeline.QuarterlyEtherPainter=function(a){this._params=a,this._theme=a.theme,this._startDate=SimileAjax.DateTime.parseGregorianDateTime(a.startDate)},Timeline.QuarterlyEtherPainter.prototype.initialize=function(a,b){this._band=a,this._timeline=b,this._backgroundLayer=a.createLayerDiv(0),this._backgroundLayer.setAttribute("name","ether-background"),this._backgroundLayer.className="timeline-ether-bg",this._markerLayer=null,this._lineLayer=null;var c="align"in this._params?this._params.align:this._theme.ether.interval.marker[b.isHorizontal()?"hAlign":"vAlign"],d="showLine"in this._params?this._params.showLine:this._theme.ether.interval.line.show;this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,this._band,this._theme,c,d),this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)},Timeline.QuarterlyEtherPainter.prototype.setHighlight=function(a,b){this._highlight.position(a,b)},Timeline.QuarterlyEtherPainter.prototype.paint=function(){this._markerLayer&&this._band.removeLayerDiv(this._markerLayer),this._markerLayer=this._band.createLayerDiv(100),this._markerLayer.setAttribute("name","ether-markers"),this._markerLayer.style.display="none",this._lineLayer&&this._band.removeLayerDiv(this._lineLayer),this._lineLayer=this._band.createLayerDiv(1),this._lineLayer.setAttribute("name","ether-lines"),this._lineLayer.style.display="none";var a=new Date(0),b=this._band.getMaxDate();a.setUTCFullYear(Math.max(this._startDate.getUTCFullYear(),this._band.getMinDate().getUTCFullYear())),a.setUTCMonth(this._startDate.getUTCMonth());for(var c=this,d=function(a){a.setUTCMonth(a.getUTCMonth()+3)},e={labelInterval:function(a){var b=(4+(a.getUTCMonth()-c._startDate.getUTCMonth())/3)%4;return 0!=b?{text:"Q"+(b+1),emphasized:!1}:{text:"Y"+(a.getUTCFullYear()-c._startDate.getUTCFullYear()+1),emphasized:!0}}};a.getTime()<b.getTime();)this._intervalMarkerLayout.createIntervalMarker(a,e,SimileAjax.DateTime.YEAR,this._markerLayer,this._lineLayer),d(a);this._markerLayer.style.display="block",this._lineLayer.style.display="block"},Timeline.QuarterlyEtherPainter.prototype.softPaint=function(){},Timeline.EtherIntervalMarkerLayout=function(a,b,c,d,e){var f=a.isHorizontal();this.positionDiv=f?"Top"==d?function(a,b){a.style.left=b+"px",a.style.top="0px"}:function(a,b){a.style.left=b+"px",a.style.bottom="0px"}:"Left"==d?function(a,b){a.style.top=b+"px",a.style.left="0px"}:function(a,b){a.style.top=b+"px",a.style.right="0px"};var g=c.ether.interval.marker,h=c.ether.interval.line,i=c.ether.interval.weekend,j=(f?"h":"v")+d,k=(g[j+"Styler"],g[j+"EmphasizedStyler"],SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.DAY]);this.createIntervalMarker=function(d,g,j,l,m){var n=Math.round(b.dateToPixelOffset(d));if(e&&j!=SimileAjax.DateTime.WEEK){var o=a.getDocument().createElement("div");o.className="timeline-ether-lines",h.opacity<100&&SimileAjax.Graphics.setOpacity(o,h.opacity),f?o.style.left=n+"px":o.style.top=n+"px",m.appendChild(o)}if(j==SimileAjax.DateTime.WEEK){var p=c.firstDayOfWeek,q=new Date(d.getTime()+(6-p-7)*k),r=new Date(q.getTime()+2*k),s=Math.round(b.dateToPixelOffset(q)),t=Math.round(b.dateToPixelOffset(r)),u=Math.max(1,t-s),v=a.getDocument().createElement("div");v.className="timeline-ether-weekends",i.opacity<100&&SimileAjax.Graphics.setOpacity(v,i.opacity),f?(v.style.left=s+"px",v.style.width=u+"px"):(v.style.top=s+"px",v.style.height=u+"px"),m.appendChild(v)}var w=g.labelInterval(d,j),x=a.getDocument().createElement("div");return x.innerHTML=w.text,x.className="timeline-date-label",w.emphasized&&(x.className+=" timeline-date-label-em"),this.positionDiv(x,n),l.appendChild(x),x}},Timeline.EtherHighlight=function(a,b,c,d){var e=a.isHorizontal();this._highlightDiv=null,this._createHighlightDiv=function(){if(null==this._highlightDiv){this._highlightDiv=a.getDocument().createElement("div"),this._highlightDiv.setAttribute("name","ether-highlight"),this._highlightDiv.className="timeline-ether-highlight";var b=c.ether.highlightOpacity;100>b&&SimileAjax.Graphics.setOpacity(this._highlightDiv,b),d.appendChild(this._highlightDiv)}},this.position=function(a,c){this._createHighlightDiv();var d=Math.round(b.dateToPixelOffset(a)),f=Math.round(b.dateToPixelOffset(c)),g=Math.max(f-d,3);e?(this._highlightDiv.style.left=d+"px",this._highlightDiv.style.width=g+"px",this._highlightDiv.style.height=b.getViewWidth()-4+"px"):(this._highlightDiv.style.top=d+"px",this._highlightDiv.style.height=g+"px",this._highlightDiv.style.width=b.getViewWidth()-4+"px")}},Timeline.EventUtils={},Timeline.EventUtils.getNewEventID=function(){
return null==this._lastEventID&&(this._lastEventID=0),this._lastEventID+=1,"e"+this._lastEventID},Timeline.EventUtils.decodeEventElID=function(a){var b=a.split("-");if("tl"!=b[1])return alert("Internal Timeline problem 101, please consult support"),{band:null,evt:null};var c=Timeline.getTimelineFromID(b[2]),d=c.getBand(b[3]),e=d.getEventSource.getEvent(b[4]);return{band:d,evt:e}},Timeline.EventUtils.encodeEventElID=function(a,b,c,d){return c+"-tl-"+a.timelineID+"-"+b.getIndex()+"-"+d.getID()},Timeline.GregorianDateLabeller=function(a,b){this._locale=a,this._timeZone=b},Timeline.GregorianDateLabeller.monthNames=[],Timeline.GregorianDateLabeller.dayNames=[],Timeline.GregorianDateLabeller.labelIntervalFunctions=[],Timeline.GregorianDateLabeller.getMonthName=function(a,b){return Timeline.GregorianDateLabeller.monthNames[b][a]},Timeline.GregorianDateLabeller.prototype.labelInterval=function(a,b){var c=Timeline.GregorianDateLabeller.labelIntervalFunctions[this._locale];return null==c&&(c=Timeline.GregorianDateLabeller.prototype.defaultLabelInterval),c.call(this,a,b)},Timeline.GregorianDateLabeller.prototype.labelPrecise=function(a){return SimileAjax.DateTime.removeTimeZoneOffset(a,this._timeZone).toUTCString()},Timeline.GregorianDateLabeller.prototype.defaultLabelInterval=function(a,b){var c,d=!1;switch(a=SimileAjax.DateTime.removeTimeZoneOffset(a,this._timeZone),b){case SimileAjax.DateTime.MILLISECOND:c=a.getUTCMilliseconds();break;case SimileAjax.DateTime.SECOND:c=a.getUTCSeconds();break;case SimileAjax.DateTime.MINUTE:var e=a.getUTCMinutes();0==e?(c=a.getUTCHours()+":00",d=!0):c=e;break;case SimileAjax.DateTime.HOUR:c=a.getUTCHours()+"hr";break;case SimileAjax.DateTime.DAY:c=Timeline.GregorianDateLabeller.getMonthName(a.getUTCMonth(),this._locale)+" "+a.getUTCDate();break;case SimileAjax.DateTime.WEEK:c=Timeline.GregorianDateLabeller.getMonthName(a.getUTCMonth(),this._locale)+" "+a.getUTCDate();break;case SimileAjax.DateTime.MONTH:var e=a.getUTCMonth();if(0!=e){c=Timeline.GregorianDateLabeller.getMonthName(e,this._locale);break}case SimileAjax.DateTime.YEAR:case SimileAjax.DateTime.DECADE:case SimileAjax.DateTime.CENTURY:case SimileAjax.DateTime.MILLENNIUM:var f=a.getUTCFullYear();c=f>0?a.getUTCFullYear():1-f+"BC",d=b==SimileAjax.DateTime.MONTH||b==SimileAjax.DateTime.DECADE&&f%100==0||b==SimileAjax.DateTime.CENTURY&&f%1e3==0;break;default:c=a.toUTCString()}return{text:c,emphasized:d}},Timeline.DefaultEventSource=function(a){this._events=a instanceof Object?a:new SimileAjax.EventIndex,this._listeners=[]},Timeline.DefaultEventSource.prototype.addListener=function(a){this._listeners.push(a)},Timeline.DefaultEventSource.prototype.removeListener=function(a){for(var b=0;b<this._listeners.length;b++)if(this._listeners[b]==a){this._listeners.splice(b,1);break}},Timeline.DefaultEventSource.prototype.loadXML=function(a,b){for(var c=this._getBaseURL(b),d=a.documentElement.getAttribute("wiki-url"),e=a.documentElement.getAttribute("wiki-section"),f=a.documentElement.getAttribute("date-time-format"),g=this._events.getUnit().getParser(f),h=a.documentElement.firstChild,i=!1;null!=h;){if(1==h.nodeType){var j="";null!=h.firstChild&&3==h.firstChild.nodeType&&(j=h.firstChild.nodeValue);var k=null===h.getAttribute("isDuration")&&null===h.getAttribute("durationEvent")||"false"==h.getAttribute("isDuration")||"false"==h.getAttribute("durationEvent"),l=new Timeline.DefaultEventSource.Event({id:h.getAttribute("id"),start:g(h.getAttribute("start")),end:g(h.getAttribute("end")),latestStart:g(h.getAttribute("latestStart")),earliestEnd:g(h.getAttribute("earliestEnd")),instant:k,text:h.getAttribute("title"),description:j,image:this._resolveRelativeURL(h.getAttribute("image"),c),link:this._resolveRelativeURL(h.getAttribute("link"),c),icon:this._resolveRelativeURL(h.getAttribute("icon"),c),color:h.getAttribute("color"),textColor:h.getAttribute("textColor"),hoverText:h.getAttribute("hoverText"),classname:h.getAttribute("classname"),tapeImage:h.getAttribute("tapeImage"),tapeRepeat:h.getAttribute("tapeRepeat"),caption:h.getAttribute("caption"),eventID:h.getAttribute("eventID"),trackNum:h.getAttribute("trackNum")});l._node=h,l.getProperty=function(a){return this._node.getAttribute(a)},l.setWikiInfo(d,e),this._events.add(l),i=!0}h=h.nextSibling}i&&this._fire("onAddMany",[])},Timeline.DefaultEventSource.prototype.loadJSON=function(a,b){var c=this._getBaseURL(b),d=!1;if(a&&a.events)for(var e=("wikiURL"in a?a.wikiURL:null),f=("wikiSection"in a?a.wikiSection:null),g=("dateTimeFormat"in a?a.dateTimeFormat:null),h=this._events.getUnit().getParser(g),i=0;i<a.events.length;i++){var j=a.events[i],k=j.isDuration||null!=j.durationEvent&&!j.durationEvent,l=new Timeline.DefaultEventSource.Event({id:"id"in j?j.id:void 0,start:h(j.start),end:h(j.end),latestStart:h(j.latestStart),earliestEnd:h(j.earliestEnd),instant:k,text:j.title,description:j.description,image:this._resolveRelativeURL(j.image,c),link:this._resolveRelativeURL(j.link,c),icon:this._resolveRelativeURL(j.icon,c),color:j.color,textColor:j.textColor,hoverText:j.hoverText,classname:j.classname,tapeImage:j.tapeImage,tapeRepeat:j.tapeRepeat,caption:j.caption,eventID:j.eventID,trackNum:j.trackNum});l._obj=j,l.getProperty=function(a){return this._obj[a]},l.setWikiInfo(e,f),this._events.add(l),d=!0}d&&this._fire("onAddMany",[])},Timeline.DefaultEventSource.prototype.loadSPARQL=function(a,b){var c=this._getBaseURL(b),d="iso8601",e=this._events.getUnit().getParser(d);if(null!=a){for(var f=a.documentElement.firstChild;null!=f&&(1!=f.nodeType||"results"!=f.nodeName);)f=f.nextSibling;var g=null,h=null;null!=f&&(g=f.getAttribute("wiki-url"),h=f.getAttribute("wiki-section"),f=f.firstChild);for(var i=!1;null!=f;){if(1==f.nodeType){for(var j={},k=f.firstChild;null!=k;)1==k.nodeType&&null!=k.firstChild&&1==k.firstChild.nodeType&&null!=k.firstChild.firstChild&&3==k.firstChild.firstChild.nodeType&&(j[k.getAttribute("name")]=k.firstChild.firstChild.nodeValue),k=k.nextSibling;null==j.start&&null!=j.date&&(j.start=j.date);var l=null===j.isDuration&&null===j.durationEvent||"false"==j.isDuration||"false"==j.durationEvent,m=new Timeline.DefaultEventSource.Event({id:j.id,start:e(j.start),end:e(j.end),latestStart:e(j.latestStart),earliestEnd:e(j.earliestEnd),instant:l,text:j.title,description:j.description,image:this._resolveRelativeURL(j.image,c),link:this._resolveRelativeURL(j.link,c),icon:this._resolveRelativeURL(j.icon,c),color:j.color,textColor:j.textColor,hoverText:j.hoverText,caption:j.caption,classname:j.classname,tapeImage:j.tapeImage,tapeRepeat:j.tapeRepeat,eventID:j.eventID,trackNum:j.trackNum});m._bindings=j,m.getProperty=function(a){return this._bindings[a]},m.setWikiInfo(g,h),this._events.add(m),i=!0}f=f.nextSibling}i&&this._fire("onAddMany",[])}},Timeline.DefaultEventSource.prototype.add=function(a){this._events.add(a),this._fire("onAddOne",[a])},Timeline.DefaultEventSource.prototype.addMany=function(a){for(var b=0;b<a.length;b++)this._events.add(a[b]);this._fire("onAddMany",[])},Timeline.DefaultEventSource.prototype.clear=function(){this._events.removeAll(),this._fire("onClear",[])},Timeline.DefaultEventSource.prototype.getEvent=function(a){return this._events.getEvent(a)},Timeline.DefaultEventSource.prototype.getEventIterator=function(a,b){return this._events.getIterator(a,b)},Timeline.DefaultEventSource.prototype.getEventReverseIterator=function(a,b){return this._events.getReverseIterator(a,b)},Timeline.DefaultEventSource.prototype.getAllEventIterator=function(){return this._events.getAllIterator()},Timeline.DefaultEventSource.prototype.getCount=function(){return this._events.getCount()},Timeline.DefaultEventSource.prototype.getEarliestDate=function(){return this._events.getEarliestDate()},Timeline.DefaultEventSource.prototype.getLatestDate=function(){return this._events.getLatestDate()},Timeline.DefaultEventSource.prototype._fire=function(a,b){for(var c=0;c<this._listeners.length;c++){var d=this._listeners[c];if(a in d)try{d[a].apply(d,b)}catch(e){SimileAjax.Debug.exception(e)}}},Timeline.DefaultEventSource.prototype._getBaseURL=function(a){if(a.indexOf("://")<0){var b=this._getBaseURL(document.location.href);a="/"==a.substr(0,1)?b.substr(0,b.indexOf("/",b.indexOf("://")+3))+a:b+a}var c=a.lastIndexOf("/");return 0>c?"":a.substr(0,c+1)},Timeline.DefaultEventSource.prototype._resolveRelativeURL=function(a,b){return null==a||""==a?a:a.indexOf("://")>0?a:"/"==a.substr(0,1)?b.substr(0,b.indexOf("/",b.indexOf("://")+3))+a:b+a},Timeline.DefaultEventSource.Event=function(a){function b(b){return null!=a[b]&&""!=a[b]?a[b]:null}var c=a.id?a.id.trim():"";this._id=c.length>0?c:Timeline.EventUtils.getNewEventID(),this._instant=a.instant||null==a.end,this._start=a.start,this._end=null!=a.end?a.end:a.start,this._latestStart=null!=a.latestStart?a.latestStart:a.instant?this._end:this._start,this._earliestEnd=null!=a.earliestEnd?a.earliestEnd:this._end;var d=[];this._start>this._latestStart&&(this._latestStart=this._start,d.push("start is > latestStart")),this._start>this._earliestEnd&&(this._earliestEnd=this._latestStart,d.push("start is > earliestEnd")),this._start>this._end&&(this._end=this._earliestEnd,d.push("start is > end")),this._latestStart>this._earliestEnd&&(this._earliestEnd=this._latestStart,d.push("latestStart is > earliestEnd")),this._latestStart>this._end&&(this._end=this._earliestEnd,d.push("latestStart is > end")),this._earliestEnd>this._end&&(this._end=this._earliestEnd,d.push("earliestEnd is > end")),this._eventID=b("eventID"),this._text=null!=a.text?SimileAjax.HTML.deEntify(a.text):"",d.length>0&&(this._text+=" PROBLEM: "+d.join(", ")),this._description=SimileAjax.HTML.deEntify(a.description),this._image=b("image"),this._link=b("link"),this._title=b("hoverText"),this._title=b("caption"),this._icon=b("icon"),this._color=b("color"),this._textColor=b("textColor"),this._classname=b("classname"),this._tapeImage=b("tapeImage"),this._tapeRepeat=b("tapeRepeat"),this._trackNum=b("trackNum"),null!=this._trackNum&&(this._trackNum=parseInt(this._trackNum)),this._wikiURL=null,this._wikiSection=null},Timeline.DefaultEventSource.Event.prototype={getID:function(){return this._id},isInstant:function(){return this._instant},isImprecise:function(){return this._start!=this._latestStart||this._end!=this._earliestEnd},getStart:function(){return this._start},getEnd:function(){return this._end},getLatestStart:function(){return this._latestStart},getEarliestEnd:function(){return this._earliestEnd},getEventID:function(){return this._eventID},getText:function(){return this._text},getDescription:function(){return this._description},getImage:function(){return this._image},getLink:function(){return this._link},getIcon:function(){return this._icon},getColor:function(){return this._color},getTextColor:function(){return this._textColor},getClassName:function(){return this._classname},getTapeImage:function(){return this._tapeImage},getTapeRepeat:function(){return this._tapeRepeat},getTrackNum:function(){return this._trackNum},getProperty:function(){return null},getWikiURL:function(){return this._wikiURL},getWikiSection:function(){return this._wikiSection},setWikiInfo:function(a,b){this._wikiURL=a,this._wikiSection=b},fillDescription:function(a){a.innerHTML=this._description},fillWikiInfo:function(a){if(a.style.display="none",null!=this._wikiURL&&null!=this._wikiSection){var b=this.getProperty("wikiID");if((null==b||0==b.length)&&(b=this.getText()),null!=b&&0!=b.length){a.style.display="inline",b=b.replace(/\s/g,"_");var c=this._wikiURL+this._wikiSection.replace(/\s/g,"_")+"/"+b,d=document.createElement("a");d.href=c,d.target="new",d.innerHTML=Timeline.strings[Timeline.clientLocale].wikiLinkLabel,a.appendChild(document.createTextNode("[")),a.appendChild(d),a.appendChild(document.createTextNode("]"))}}},fillTime:function(a,b){this._instant?this.isImprecise()?(a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._start))),a.appendChild(a.ownerDocument.createElement("br")),a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._end)))):a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._start))):this.isImprecise()?(a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._start)+" ~ "+b.labelPrecise(this._latestStart))),a.appendChild(a.ownerDocument.createElement("br")),a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._earliestEnd)+" ~ "+b.labelPrecise(this._end)))):(a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._start))),a.appendChild(a.ownerDocument.createElement("br")),a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._end))))},fillInfoBubble:function(a,b,c){var d=a.ownerDocument,e=this.getText(),f=this.getLink(),g=this.getImage();if(null!=g){var h=d.createElement("img");h.src=g,b.event.bubble.imageStyler(h),a.appendChild(h)}var i=d.createElement("div"),j=d.createTextNode(e);if(null!=f){var k=d.createElement("a");k.href=f,k.appendChild(j),i.appendChild(k)}else i.appendChild(j);b.event.bubble.titleStyler(i),a.appendChild(i);var l=d.createElement("div");this.fillDescription(l),b.event.bubble.bodyStyler(l),a.appendChild(l);var m=d.createElement("div");this.fillTime(m,c),b.event.bubble.timeStyler(m),a.appendChild(m);var n=d.createElement("div");this.fillWikiInfo(n),b.event.bubble.wikiStyler(n),a.appendChild(n)}},Timeline.OriginalEventPainter=function(a){this._params=a,this._onSelectListeners=[],this._eventPaintListeners=[],this._filterMatcher=null,this._highlightMatcher=null,this._frc=null,this._eventIdToElmt={}},Timeline.OriginalEventPainter.prototype.initialize=function(a,b){this._band=a,this._timeline=b,this._backLayer=null,this._eventLayer=null,this._lineLayer=null,this._highlightLayer=null,this._eventIdToElmt=null},Timeline.OriginalEventPainter.prototype.getType=function(){return"original"},Timeline.OriginalEventPainter.prototype.addOnSelectListener=function(a){this._onSelectListeners.push(a)},Timeline.OriginalEventPainter.prototype.removeOnSelectListener=function(a){for(var b=0;b<this._onSelectListeners.length;b++)if(this._onSelectListeners[b]==a){this._onSelectListeners.splice(b,1);break}},Timeline.OriginalEventPainter.prototype.addEventPaintListener=function(a){this._eventPaintListeners.push(a)},Timeline.OriginalEventPainter.prototype.removeEventPaintListener=function(a){for(var b=0;b<this._eventPaintListeners.length;b++)if(this._eventPaintListeners[b]==a){this._eventPaintListeners.splice(b,1);break}},Timeline.OriginalEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher},Timeline.OriginalEventPainter.prototype.setFilterMatcher=function(a){this._filterMatcher=a},Timeline.OriginalEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher},Timeline.OriginalEventPainter.prototype.setHighlightMatcher=function(a){this._highlightMatcher=a},Timeline.OriginalEventPainter.prototype.paint=function(){var a=this._band.getEventSource();if(null!=a){this._eventIdToElmt={},this._fireEventPaintListeners("paintStarting",null,null),this._prepareForPainting();for(var b=this._params.theme.event,c=Math.max(b.track.height,b.tape.height+this._frc.getLineHeight()),d={trackOffset:b.track.offset,trackHeight:c,trackGap:b.track.gap,trackIncrement:c+b.track.gap,icon:b.instant.icon,iconWidth:b.instant.iconWidth,iconHeight:b.instant.iconHeight,labelWidth:b.label.width,maxLabelChar:b.label.maxLabelChar,impreciseIconMargin:b.instant.impreciseIconMargin},e=this._band.getMinDate(),f=this._band.getMaxDate(),g=null!=this._filterMatcher?this._filterMatcher:function(){return!0},h=null!=this._highlightMatcher?this._highlightMatcher:function(){return-1},i=a.getEventReverseIterator(e,f);i.hasNext();){var j=i.next();g(j)&&this.paintEvent(j,d,this._params.theme,h(j))}this._highlightLayer.style.display="block",this._lineLayer.style.display="block",this._eventLayer.style.display="block",this._band.updateEventTrackInfo(this._tracks.length,d.trackIncrement),this._fireEventPaintListeners("paintEnded",null,null)}},Timeline.OriginalEventPainter.prototype.softPaint=function(){},Timeline.OriginalEventPainter.prototype._prepareForPainting=function(){var a=this._band;if(null==this._backLayer){this._backLayer=this._band.createLayerDiv(0,"timeline-band-events"),this._backLayer.style.visibility="hidden";var b=document.createElement("span");b.className="timeline-event-label",this._backLayer.appendChild(b),this._frc=SimileAjax.Graphics.getFontRenderingContext(b)}this._frc.update(),this._tracks=[],null!=this._highlightLayer&&a.removeLayerDiv(this._highlightLayer),this._highlightLayer=a.createLayerDiv(105,"timeline-band-highlights"),this._highlightLayer.style.display="none",null!=this._lineLayer&&a.removeLayerDiv(this._lineLayer),this._lineLayer=a.createLayerDiv(110,"timeline-band-lines"),this._lineLayer.style.display="none",null!=this._eventLayer&&a.removeLayerDiv(this._eventLayer),this._eventLayer=a.createLayerDiv(115,"timeline-band-events"),this._eventLayer.style.display="none"},Timeline.OriginalEventPainter.prototype.paintEvent=function(a,b,c,d){a.isInstant()?this.paintInstantEvent(a,b,c,d):this.paintDurationEvent(a,b,c,d)},Timeline.OriginalEventPainter.prototype.paintInstantEvent=function(a,b,c,d){a.isImprecise()?this.paintImpreciseInstantEvent(a,b,c,d):this.paintPreciseInstantEvent(a,b,c,d)},Timeline.OriginalEventPainter.prototype.paintDurationEvent=function(a,b,c,d){a.isImprecise()?this.paintImpreciseDurationEvent(a,b,c,d):this.paintPreciseDurationEvent(a,b,c,d)},Timeline.OriginalEventPainter.prototype.paintPreciseInstantEvent=function(a,b,c,d){var e=(this._timeline.getDocument(),a.getText()),f=a.getStart(),g=Math.round(this._band.dateToPixelOffset(f)),h=Math.round(g+b.iconWidth/2),i=Math.round(g-b.iconWidth/2),j=this._getLabelDivClassName(a),k=this._frc.computeSize(e,j),l=h+c.event.label.offsetFromLine,m=l+k.width,n=m,o=this._findFreeTrack(a,n),p=Math.round(b.trackOffset+o*b.trackIncrement+b.trackHeight/2-k.height/2),q=this._paintEventIcon(a,o,i,b,c,0),r=this._paintEventLabel(a,e,l,p,k.width,k.height,c,j,d),s=[q.elmt,r.elmt],t=this,u=function(b,c){return t._onClickInstantEvent(q.elmt,c,a)};SimileAjax.DOM.registerEvent(q.elmt,"mousedown",u),SimileAjax.DOM.registerEvent(r.elmt,"mousedown",u);var v=this._createHighlightDiv(d,q,c,a);null!=v&&s.push(v),this._fireEventPaintListeners("paintedEvent",a,s),this._eventIdToElmt[a.getID()]=q.elmt,this._tracks[o]=i},Timeline.OriginalEventPainter.prototype.paintImpreciseInstantEvent=function(a,b,c,d){var e=(this._timeline.getDocument(),a.getText()),f=a.getStart(),g=a.getEnd(),h=Math.round(this._band.dateToPixelOffset(f)),i=Math.round(this._band.dateToPixelOffset(g)),j=Math.round(h+b.iconWidth/2),k=Math.round(h-b.iconWidth/2),l=this._getLabelDivClassName(a),m=this._frc.computeSize(e,l),n=j+c.event.label.offsetFromLine,o=n+m.width,p=Math.max(o,i),q=this._findFreeTrack(a,p),r=c.event.tape.height,s=Math.round(b.trackOffset+q*b.trackIncrement+r),t=this._paintEventIcon(a,q,k,b,c,r),u=this._paintEventLabel(a,e,n,s,m.width,m.height,c,l,d),v=a.getColor();v=null!=v?v:c.event.instant.impreciseColor;var w=this._paintEventTape(a,q,h,i,v,c.event.instant.impreciseOpacity,b,c,0),x=[t.elmt,u.elmt,w.elmt],y=this,z=function(b,c){return y._onClickInstantEvent(t.elmt,c,a)};SimileAjax.DOM.registerEvent(t.elmt,"mousedown",z),SimileAjax.DOM.registerEvent(w.elmt,"mousedown",z),SimileAjax.DOM.registerEvent(u.elmt,"mousedown",z);var A=this._createHighlightDiv(d,t,c,a);null!=A&&x.push(A),this._fireEventPaintListeners("paintedEvent",a,x),this._eventIdToElmt[a.getID()]=t.elmt,this._tracks[q]=k},Timeline.OriginalEventPainter.prototype.paintPreciseDurationEvent=function(a,b,c,d){var e=(this._timeline.getDocument(),a.getText()),f=a.getStart(),g=a.getEnd(),h=Math.round(this._band.dateToPixelOffset(f)),i=Math.round(this._band.dateToPixelOffset(g)),j=this._getLabelDivClassName(a),k=this._frc.computeSize(e,j),l=h,m=l+k.width,n=Math.max(m,i),o=this._findFreeTrack(a,n),p=Math.round(b.trackOffset+o*b.trackIncrement+c.event.tape.height),q=a.getColor();q=null!=q?q:c.event.duration.color;var r=this._paintEventTape(a,o,h,i,q,100,b,c,0),s=this._paintEventLabel(a,e,l,p,k.width,k.height,c,j,d),t=[r.elmt,s.elmt],u=this,v=function(b,c){return u._onClickDurationEvent(r.elmt,c,a)};SimileAjax.DOM.registerEvent(r.elmt,"mousedown",v),SimileAjax.DOM.registerEvent(s.elmt,"mousedown",v);var w=this._createHighlightDiv(d,r,c,a);null!=w&&t.push(w),this._fireEventPaintListeners("paintedEvent",a,t),this._eventIdToElmt[a.getID()]=r.elmt,this._tracks[o]=h},Timeline.OriginalEventPainter.prototype.paintImpreciseDurationEvent=function(a,b,c,d){var e=(this._timeline.getDocument(),a.getText()),f=a.getStart(),g=a.getLatestStart(),h=a.getEnd(),i=a.getEarliestEnd(),j=Math.round(this._band.dateToPixelOffset(f)),k=Math.round(this._band.dateToPixelOffset(g)),l=Math.round(this._band.dateToPixelOffset(h)),m=Math.round(this._band.dateToPixelOffset(i)),n=this._getLabelDivClassName(a),o=this._frc.computeSize(e,n),p=k,q=p+o.width,r=Math.max(q,l),s=this._findFreeTrack(a,r),t=Math.round(b.trackOffset+s*b.trackIncrement+c.event.tape.height),u=a.getColor();u=null!=u?u:c.event.duration.color;var v=this._paintEventTape(a,s,j,l,c.event.duration.impreciseColor,c.event.duration.impreciseOpacity,b,c,0),w=this._paintEventTape(a,s,k,m,u,100,b,c,1),x=this._paintEventLabel(a,e,p,t,o.width,o.height,c,n,d),y=[v.elmt,w.elmt,x.elmt],z=this,A=function(b,c){return z._onClickDurationEvent(w.elmt,c,a)};SimileAjax.DOM.registerEvent(w.elmt,"mousedown",A),SimileAjax.DOM.registerEvent(x.elmt,"mousedown",A);var B=this._createHighlightDiv(d,w,c,a);null!=B&&y.push(B),this._fireEventPaintListeners("paintedEvent",a,y),this._eventIdToElmt[a.getID()]=w.elmt,this._tracks[s]=j},Timeline.OriginalEventPainter.prototype._encodeEventElID=function(a,b){return Timeline.EventUtils.encodeEventElID(this._timeline,this._band,a,b)},Timeline.OriginalEventPainter.prototype._findFreeTrack=function(a,b){var c=a.getTrackNum();if(null!=c)return c;for(var d=0;d<this._tracks.length;d++){var e=this._tracks[d];if(e>b)break}return d},Timeline.OriginalEventPainter.prototype._paintEventIcon=function(a,b,c,d,e,f){var g=a.getIcon();g=null!=g?g:d.icon;var h;if(f>0)h=d.trackOffset+b*d.trackIncrement+f+d.impreciseIconMargin;else{var i=d.trackOffset+b*d.trackIncrement+d.trackHeight/2;h=Math.round(i-d.iconHeight/2)}var j=SimileAjax.Graphics.createTranslucentImage(g),k=this._timeline.getDocument().createElement("div");return k.className=this._getElClassName("timeline-event-icon",a,"icon"),k.id=this._encodeEventElID("icon",a),k.style.left=c+"px",k.style.top=h+"px",k.appendChild(j),null!=a._title&&(k.title=a._title),this._eventLayer.appendChild(k),{left:c,top:h,width:d.iconWidth,height:d.iconHeight,elmt:k}},Timeline.OriginalEventPainter.prototype._paintEventLabel=function(a,b,c,d,e,f,g,h,i){var j=this._timeline.getDocument(),k=j.createElement("div");k.className=h,k.id=this._encodeEventElID("label",a),k.style.left=c+"px",k.style.width=e+"px",k.style.top=d+"px",k.innerHTML=b,null!=a._title&&(k.title=a._title);var l=a.getTextColor();return null==l&&(l=a.getColor()),null!=l&&(k.style.color=l),g.event.highlightLabelBackground&&i>=0&&(k.style.background=this._getHighlightColor(i,g)),this._eventLayer.appendChild(k),{left:c,top:d,width:e,height:f,elmt:k}},Timeline.OriginalEventPainter.prototype._paintEventTape=function(a,b,c,d,e,f,g,h,i){var j=d-c,k=h.event.tape.height,l=g.trackOffset+b*g.trackIncrement,m=this._timeline.getDocument().createElement("div");m.className=this._getElClassName("timeline-event-tape",a,"tape"),m.id=this._encodeEventElID("tape"+i,a),m.style.left=c+"px",m.style.width=j+"px",m.style.height=k+"px",m.style.top=l+"px",null!=a._title&&(m.title=a._title),null!=e&&(m.style.backgroundColor=e);var n=a.getTapeImage(),o=a.getTapeRepeat();return o=null!=o?o:"repeat",null!=n&&(m.style.backgroundImage="url("+n+")",m.style.backgroundRepeat=o),SimileAjax.Graphics.setOpacity(m,f),this._eventLayer.appendChild(m),{left:c,top:l,width:j,height:k,elmt:m}},Timeline.OriginalEventPainter.prototype._getLabelDivClassName=function(a){return this._getElClassName("timeline-event-label",a,"label")},Timeline.OriginalEventPainter.prototype._getElClassName=function(a,b,c){var d=b.getClassName(),e=[];return d&&(c&&e.push(c+"-"+d+" "),e.push(d+" ")),e.push(a),e.join("")},Timeline.OriginalEventPainter.prototype._getHighlightColor=function(a,b){var c=b.event.highlightColors;return c[Math.min(a,c.length-1)]},Timeline.OriginalEventPainter.prototype._createHighlightDiv=function(a,b,c,d){var e=null;if(a>=0){var f=this._timeline.getDocument(),g=this._getHighlightColor(a,c);e=f.createElement("div"),e.className=this._getElClassName("timeline-event-highlight",d,"highlight"),e.id=this._encodeEventElID("highlight0",d),e.style.position="absolute",e.style.overflow="hidden",e.style.left=b.left-2+"px",e.style.width=b.width+4+"px",e.style.top=b.top-2+"px",e.style.height=b.height+4+"px",e.style.background=g,this._highlightLayer.appendChild(e)}return e},Timeline.OriginalEventPainter.prototype._onClickInstantEvent=function(a,b,c){var d=SimileAjax.DOM.getPageCoordinates(a);return this._showBubble(d.left+Math.ceil(a.offsetWidth/2),d.top+Math.ceil(a.offsetHeight/2),c),this._fireOnSelect(c.getID()),b.cancelBubble=!0,SimileAjax.DOM.cancelEvent(b),!1},Timeline.OriginalEventPainter.prototype._onClickDurationEvent=function(a,b,c){if("pageX"in b)var d=b.pageX,e=b.pageY;else var f=SimileAjax.DOM.getPageCoordinates(a),d=b.offsetX+f.left,e=b.offsetY+f.top;return this._showBubble(d,e,c),this._fireOnSelect(c.getID()),b.cancelBubble=!0,SimileAjax.DOM.cancelEvent(b),!1},Timeline.OriginalEventPainter.prototype.showBubble=function(a){var b=this._eventIdToElmt[a.getID()];if(b){var c=SimileAjax.DOM.getPageCoordinates(b);this._showBubble(c.left+b.offsetWidth/2,c.top+b.offsetHeight/2,a)}},Timeline.OriginalEventPainter.prototype._showBubble=function(a,b,c){var d=document.createElement("div"),e=this._params.theme.event.bubble;c.fillInfoBubble(d,this._params.theme,this._band.getLabeller()),SimileAjax.WindowManager.cancelPopups(),SimileAjax.Graphics.createBubbleForContentAndPoint(d,a,b,e.width,null,e.maxHeight)},Timeline.OriginalEventPainter.prototype._fireOnSelect=function(a){for(var b=0;b<this._onSelectListeners.length;b++)this._onSelectListeners[b](a)},Timeline.OriginalEventPainter.prototype._fireEventPaintListeners=function(a,b,c){for(var d=0;d<this._eventPaintListeners.length;d++)this._eventPaintListeners[d](this._band,a,b,c)},Timeline.DetailedEventPainter=function(a){this._params=a,this._onSelectListeners=[],this._filterMatcher=null,this._highlightMatcher=null,this._frc=null,this._eventIdToElmt={}},Timeline.DetailedEventPainter.prototype.initialize=function(a,b){this._band=a,this._timeline=b,this._backLayer=null,this._eventLayer=null,this._lineLayer=null,this._highlightLayer=null,this._eventIdToElmt=null},Timeline.DetailedEventPainter.prototype.getType=function(){return"detailed"},Timeline.DetailedEventPainter.prototype.addOnSelectListener=function(a){this._onSelectListeners.push(a)},Timeline.DetailedEventPainter.prototype.removeOnSelectListener=function(a){for(var b=0;b<this._onSelectListeners.length;b++)if(this._onSelectListeners[b]==a){this._onSelectListeners.splice(b,1);break}},Timeline.DetailedEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher},Timeline.DetailedEventPainter.prototype.setFilterMatcher=function(a){this._filterMatcher=a},Timeline.DetailedEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher},Timeline.DetailedEventPainter.prototype.setHighlightMatcher=function(a){this._highlightMatcher=a},Timeline.DetailedEventPainter.prototype.paint=function(){var a=this._band.getEventSource();if(null!=a){this._eventIdToElmt={},this._prepareForPainting();for(var b=this._params.theme.event,c=Math.max(b.track.height,this._frc.getLineHeight()),d={trackOffset:Math.round(this._band.getViewWidth()/2-c/2),trackHeight:c,trackGap:b.track.gap,trackIncrement:c+b.track.gap,icon:b.instant.icon,iconWidth:b.instant.iconWidth,iconHeight:b.instant.iconHeight,labelWidth:b.label.width},e=this._band.getMinDate(),f=this._band.getMaxDate(),g=null!=this._filterMatcher?this._filterMatcher:function(){return!0},h=null!=this._highlightMatcher?this._highlightMatcher:function(){return-1},i=a.getEventReverseIterator(e,f);i.hasNext();){var j=i.next();g(j)&&this.paintEvent(j,d,this._params.theme,h(j))}this._highlightLayer.style.display="block",this._lineLayer.style.display="block",this._eventLayer.style.display="block",this._band.updateEventTrackInfo(this._lowerTracks.length+this._upperTracks.length,d.trackIncrement)}},Timeline.DetailedEventPainter.prototype.softPaint=function(){},Timeline.DetailedEventPainter.prototype._prepareForPainting=function(){var a=this._band;if(null==this._backLayer){this._backLayer=this._band.createLayerDiv(0,"timeline-band-events"),this._backLayer.style.visibility="hidden";var b=document.createElement("span");b.className="timeline-event-label",this._backLayer.appendChild(b),this._frc=SimileAjax.Graphics.getFontRenderingContext(b)}this._frc.update(),this._lowerTracks=[],this._upperTracks=[],null!=this._highlightLayer&&a.removeLayerDiv(this._highlightLayer),this._highlightLayer=a.createLayerDiv(105,"timeline-band-highlights"),this._highlightLayer.style.display="none",null!=this._lineLayer&&a.removeLayerDiv(this._lineLayer),this._lineLayer=a.createLayerDiv(110,"timeline-band-lines"),this._lineLayer.style.display="none",null!=this._eventLayer&&a.removeLayerDiv(this._eventLayer),this._eventLayer=a.createLayerDiv(110,"timeline-band-events"),this._eventLayer.style.display="none"},Timeline.DetailedEventPainter.prototype.paintEvent=function(a,b,c,d){a.isInstant()?this.paintInstantEvent(a,b,c,d):this.paintDurationEvent(a,b,c,d)},Timeline.DetailedEventPainter.prototype.paintInstantEvent=function(a,b,c,d){a.isImprecise()?this.paintImpreciseInstantEvent(a,b,c,d):this.paintPreciseInstantEvent(a,b,c,d)},Timeline.DetailedEventPainter.prototype.paintDurationEvent=function(a,b,c,d){a.isImprecise()?this.paintImpreciseDurationEvent(a,b,c,d):this.paintPreciseDurationEvent(a,b,c,d)},Timeline.DetailedEventPainter.prototype.paintPreciseInstantEvent=function(a,b,c,d){var e=(this._timeline.getDocument(),a.getText()),f=a.getStart(),g=Math.round(this._band.dateToPixelOffset(f)),h=Math.round(g+b.iconWidth/2),i=Math.round(g-b.iconWidth/2),j=this._frc.computeSize(e),k=this._findFreeTrackForSolid(h,g),l=this._paintEventIcon(a,k,i,b,c),m=h+c.event.label.offsetFromLine,n=k,o=this._getTrackData(k);Math.min(o.solid,o.text)>=m+j.width?(o.solid=i,o.text=m):(o.solid=i,m=g+c.event.label.offsetFromLine,n=this._findFreeTrackForText(k,m+j.width,function(a){a.line=g-2}),this._getTrackData(n).text=i,this._paintEventLine(a,g,k,n,b,c));var p=Math.round(b.trackOffset+n*b.trackIncrement+b.trackHeight/2-j.height/2),q=this._paintEventLabel(a,e,m,p,j.width,j.height,c),r=this,s=function(b,c){return r._onClickInstantEvent(l.elmt,c,a)};SimileAjax.DOM.registerEvent(l.elmt,"mousedown",s),SimileAjax.DOM.registerEvent(q.elmt,"mousedown",s),this._createHighlightDiv(d,l,c),this._eventIdToElmt[a.getID()]=l.elmt},Timeline.DetailedEventPainter.prototype.paintImpreciseInstantEvent=function(a,b,c,d){var e=(this._timeline.getDocument(),a.getText()),f=a.getStart(),g=a.getEnd(),h=Math.round(this._band.dateToPixelOffset(f)),i=Math.round(this._band.dateToPixelOffset(g)),j=Math.round(h+b.iconWidth/2),k=Math.round(h-b.iconWidth/2),l=this._frc.computeSize(e),m=this._findFreeTrackForSolid(i,h),n=this._paintEventTape(a,m,h,i,c.event.instant.impreciseColor,c.event.instant.impreciseOpacity,b,c),o=this._paintEventIcon(a,m,k,b,c),p=this._getTrackData(m);p.solid=k;var q,r=j+c.event.label.offsetFromLine,s=r+l.width;i>s?q=m:(r=h+c.event.label.offsetFromLine,s=r+l.width,q=this._findFreeTrackForText(m,s,function(a){a.line=h-2}),this._getTrackData(q).text=k,this._paintEventLine(a,h,m,q,b,c));var t=Math.round(b.trackOffset+q*b.trackIncrement+b.trackHeight/2-l.height/2),u=this._paintEventLabel(a,e,r,t,l.width,l.height,c),v=this,w=function(b,c){
return v._onClickInstantEvent(o.elmt,c,a)};SimileAjax.DOM.registerEvent(o.elmt,"mousedown",w),SimileAjax.DOM.registerEvent(n.elmt,"mousedown",w),SimileAjax.DOM.registerEvent(u.elmt,"mousedown",w),this._createHighlightDiv(d,o,c),this._eventIdToElmt[a.getID()]=o.elmt},Timeline.DetailedEventPainter.prototype.paintPreciseDurationEvent=function(a,b,c,d){var e=(this._timeline.getDocument(),a.getText()),f=a.getStart(),g=a.getEnd(),h=Math.round(this._band.dateToPixelOffset(f)),i=Math.round(this._band.dateToPixelOffset(g)),j=this._frc.computeSize(e),k=this._findFreeTrackForSolid(i),l=a.getColor();l=null!=l?l:c.event.duration.color;var m=this._paintEventTape(a,k,h,i,l,100,b,c),n=this._getTrackData(k);n.solid=h;var o=h+c.event.label.offsetFromLine,p=this._findFreeTrackForText(k,o+j.width,function(a){a.line=h-2});this._getTrackData(p).text=h-2,this._paintEventLine(a,h,k,p,b,c);var q=Math.round(b.trackOffset+p*b.trackIncrement+b.trackHeight/2-j.height/2),r=this._paintEventLabel(a,e,o,q,j.width,j.height,c),s=this,t=function(b,c){return s._onClickDurationEvent(m.elmt,c,a)};SimileAjax.DOM.registerEvent(m.elmt,"mousedown",t),SimileAjax.DOM.registerEvent(r.elmt,"mousedown",t),this._createHighlightDiv(d,m,c),this._eventIdToElmt[a.getID()]=m.elmt},Timeline.DetailedEventPainter.prototype.paintImpreciseDurationEvent=function(a,b,c,d){var e=(this._timeline.getDocument(),a.getText()),f=a.getStart(),g=a.getLatestStart(),h=a.getEnd(),i=a.getEarliestEnd(),j=Math.round(this._band.dateToPixelOffset(f)),k=Math.round(this._band.dateToPixelOffset(g)),l=Math.round(this._band.dateToPixelOffset(h)),m=Math.round(this._band.dateToPixelOffset(i)),n=this._frc.computeSize(e),o=this._findFreeTrackForSolid(l),p=a.getColor();p=null!=p?p:c.event.duration.color;var q=(this._paintEventTape(a,o,j,l,c.event.duration.impreciseColor,c.event.duration.impreciseOpacity,b,c),this._paintEventTape(a,o,k,m,p,100,b,c)),r=this._getTrackData(o);r.solid=j;var s=k+c.event.label.offsetFromLine,t=this._findFreeTrackForText(o,s+n.width,function(a){a.line=k-2});this._getTrackData(t).text=k-2,this._paintEventLine(a,k,o,t,b,c);var u=Math.round(b.trackOffset+t*b.trackIncrement+b.trackHeight/2-n.height/2),v=this._paintEventLabel(a,e,s,u,n.width,n.height,c),w=this,x=function(b,c){return w._onClickDurationEvent(q.elmt,c,a)};SimileAjax.DOM.registerEvent(q.elmt,"mousedown",x),SimileAjax.DOM.registerEvent(v.elmt,"mousedown",x),this._createHighlightDiv(d,q,c),this._eventIdToElmt[a.getID()]=q.elmt},Timeline.DetailedEventPainter.prototype._findFreeTrackForSolid=function(a,b){for(var c=0;!0;c++){if(!(c<this._lowerTracks.length))return this._lowerTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY}),c;var d=this._lowerTracks[c];if(Math.min(d.solid,d.text)>a&&(!b||d.line>b))return c;if(!(c<this._upperTracks.length))return this._upperTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY}),-1-c;var d=this._upperTracks[c];if(Math.min(d.solid,d.text)>a&&(!b||d.line>b))return-1-c}},Timeline.DetailedEventPainter.prototype._findFreeTrackForText=function(a,b,c){var d,e,f,g;if(0>a)d=!0,f=-a,e=this._findFreeUpperTrackForText(f,b),g=-1-e;else if(a>0)d=!1,f=a+1,e=this._findFreeLowerTrackForText(f,b),g=e;else{var h=this._findFreeUpperTrackForText(0,b),i=this._findFreeLowerTrackForText(1,b);h>=i-1?(d=!1,f=1,e=i,g=e):(d=!0,f=0,e=h,g=-1-e)}if(d){e==this._upperTracks.length&&this._upperTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY});for(var j=f;e>j;j++)c(this._upperTracks[j])}else{e==this._lowerTracks.length&&this._lowerTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY});for(var j=f;e>j;j++)c(this._lowerTracks[j])}return g},Timeline.DetailedEventPainter.prototype._findFreeLowerTrackForText=function(a,b){for(;a<this._lowerTracks.length;a++){var c=this._lowerTracks[a];if(Math.min(c.solid,c.text)>=b)break}return a},Timeline.DetailedEventPainter.prototype._findFreeUpperTrackForText=function(a,b){for(;a<this._upperTracks.length;a++){var c=this._upperTracks[a];if(Math.min(c.solid,c.text)>=b)break}return a},Timeline.DetailedEventPainter.prototype._getTrackData=function(a){return 0>a?this._upperTracks[-a-1]:this._lowerTracks[a]},Timeline.DetailedEventPainter.prototype._paintEventLine=function(a,b,c,d,e,f){var g=Math.round(e.trackOffset+c*e.trackIncrement+e.trackHeight/2),h=Math.round(Math.abs(d-c)*e.trackIncrement),i="1px solid "+f.event.label.lineColor,j=this._timeline.getDocument().createElement("div");j.style.position="absolute",j.style.left=b+"px",j.style.width=f.event.label.offsetFromLine+"px",j.style.height=h+"px",c>d?(j.style.top=g-h+"px",j.style.borderTop=i):(j.style.top=g+"px",j.style.borderBottom=i),j.style.borderLeft=i,this._lineLayer.appendChild(j)},Timeline.DetailedEventPainter.prototype._paintEventIcon=function(a,b,c,d){var e=a.getIcon();e=null!=e?e:d.icon;var f=d.trackOffset+b*d.trackIncrement+d.trackHeight/2,g=Math.round(f-d.iconHeight/2),h=SimileAjax.Graphics.createTranslucentImage(e),i=this._timeline.getDocument().createElement("div");return i.style.position="absolute",i.style.left=c+"px",i.style.top=g+"px",i.appendChild(h),i.style.cursor="pointer",null!=a._title&&(i.title=a._title),this._eventLayer.appendChild(i),{left:c,top:g,width:d.iconWidth,height:d.iconHeight,elmt:i}},Timeline.DetailedEventPainter.prototype._paintEventLabel=function(a,b,c,d,e,f,g){var h=this._timeline.getDocument(),i=h.createElement("div");i.style.position="absolute",i.style.left=c+"px",i.style.width=e+"px",i.style.top=d+"px",i.style.height=f+"px",i.style.backgroundColor=g.event.label.backgroundColor,SimileAjax.Graphics.setOpacity(i,g.event.label.backgroundOpacity),this._eventLayer.appendChild(i);var j=h.createElement("div");j.style.position="absolute",j.style.left=c+"px",j.style.width=e+"px",j.style.top=d+"px",j.innerHTML=b,j.style.cursor="pointer",null!=a._title&&(j.title=a._title);var k=a.getTextColor();return null==k&&(k=a.getColor()),null!=k&&(j.style.color=k),this._eventLayer.appendChild(j),{left:c,top:d,width:e,height:f,elmt:j}},Timeline.DetailedEventPainter.prototype._paintEventTape=function(a,b,c,d,e,f,g,h){var i=d-c,j=h.event.tape.height,k=g.trackOffset+b*g.trackIncrement+g.trackHeight/2,l=Math.round(k-j/2),m=this._timeline.getDocument().createElement("div");return m.style.position="absolute",m.style.left=c+"px",m.style.width=i+"px",m.style.top=l+"px",m.style.height=j+"px",m.style.backgroundColor=e,m.style.overflow="hidden",m.style.cursor="pointer",null!=a._title&&(m.title=a._title),SimileAjax.Graphics.setOpacity(m,f),this._eventLayer.appendChild(m),{left:c,top:l,width:i,height:j,elmt:m}},Timeline.DetailedEventPainter.prototype._createHighlightDiv=function(a,b,c){if(a>=0){var d=this._timeline.getDocument(),e=c.event,f=e.highlightColors[Math.min(a,e.highlightColors.length-1)],g=d.createElement("div");g.style.position="absolute",g.style.overflow="hidden",g.style.left=b.left-2+"px",g.style.width=b.width+4+"px",g.style.top=b.top-2+"px",g.style.height=b.height+4+"px",g.style.background=f,this._highlightLayer.appendChild(g)}},Timeline.DetailedEventPainter.prototype._onClickInstantEvent=function(a,b,c){var d=SimileAjax.DOM.getPageCoordinates(a);return this._showBubble(d.left+Math.ceil(a.offsetWidth/2),d.top+Math.ceil(a.offsetHeight/2),c),this._fireOnSelect(c.getID()),b.cancelBubble=!0,SimileAjax.DOM.cancelEvent(b),!1},Timeline.DetailedEventPainter.prototype._onClickDurationEvent=function(a,b,c){if("pageX"in b)var d=b.pageX,e=b.pageY;else var f=SimileAjax.DOM.getPageCoordinates(a),d=b.offsetX+f.left,e=b.offsetY+f.top;return this._showBubble(d,e,c),this._fireOnSelect(c.getID()),b.cancelBubble=!0,SimileAjax.DOM.cancelEvent(b),!1},Timeline.DetailedEventPainter.prototype.showBubble=function(a){var b=this._eventIdToElmt[a.getID()];if(b){var c=SimileAjax.DOM.getPageCoordinates(b);this._showBubble(c.left+b.offsetWidth/2,c.top+b.offsetHeight/2,a)}},Timeline.DetailedEventPainter.prototype._showBubble=function(a,b,c){var d=document.createElement("div"),e=this._params.theme.event.bubble;c.fillInfoBubble(d,this._params.theme,this._band.getLabeller()),SimileAjax.WindowManager.cancelPopups(),SimileAjax.Graphics.createBubbleForContentAndPoint(d,a,b,e.width,null,e.maxHeight)},Timeline.DetailedEventPainter.prototype._fireOnSelect=function(a){for(var b=0;b<this._onSelectListeners.length;b++)this._onSelectListeners[b](a)},Timeline.OverviewEventPainter=function(a){this._params=a,this._onSelectListeners=[],this._filterMatcher=null,this._highlightMatcher=null},Timeline.OverviewEventPainter.prototype.initialize=function(a,b){this._band=a,this._timeline=b,this._eventLayer=null,this._highlightLayer=null},Timeline.OverviewEventPainter.prototype.getType=function(){return"overview"},Timeline.OverviewEventPainter.prototype.addOnSelectListener=function(a){this._onSelectListeners.push(a)},Timeline.OverviewEventPainter.prototype.removeOnSelectListener=function(a){for(var b=0;b<this._onSelectListeners.length;b++)if(this._onSelectListeners[b]==a){this._onSelectListeners.splice(b,1);break}},Timeline.OverviewEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher},Timeline.OverviewEventPainter.prototype.setFilterMatcher=function(a){this._filterMatcher=a},Timeline.OverviewEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher},Timeline.OverviewEventPainter.prototype.setHighlightMatcher=function(a){this._highlightMatcher=a},Timeline.OverviewEventPainter.prototype.paint=function(){var a=this._band.getEventSource();if(null!=a){this._prepareForPainting();for(var b=this._params.theme.event,c={trackOffset:b.overviewTrack.offset,trackHeight:b.overviewTrack.height,trackGap:b.overviewTrack.gap,trackIncrement:b.overviewTrack.height+b.overviewTrack.gap},d=this._band.getMinDate(),e=this._band.getMaxDate(),f=null!=this._filterMatcher?this._filterMatcher:function(){return!0},g=null!=this._highlightMatcher?this._highlightMatcher:function(){return-1},h=a.getEventReverseIterator(d,e);h.hasNext();){var i=h.next();f(i)&&this.paintEvent(i,c,this._params.theme,g(i))}this._highlightLayer.style.display="block",this._eventLayer.style.display="block",this._band.updateEventTrackInfo(this._tracks.length,c.trackIncrement)}},Timeline.OverviewEventPainter.prototype.softPaint=function(){},Timeline.OverviewEventPainter.prototype._prepareForPainting=function(){var a=this._band;this._tracks=[],null!=this._highlightLayer&&a.removeLayerDiv(this._highlightLayer),this._highlightLayer=a.createLayerDiv(105,"timeline-band-highlights"),this._highlightLayer.style.display="none",null!=this._eventLayer&&a.removeLayerDiv(this._eventLayer),this._eventLayer=a.createLayerDiv(110,"timeline-band-events"),this._eventLayer.style.display="none"},Timeline.OverviewEventPainter.prototype.paintEvent=function(a,b,c,d){a.isInstant()?this.paintInstantEvent(a,b,c,d):this.paintDurationEvent(a,b,c,d)},Timeline.OverviewEventPainter.prototype.paintInstantEvent=function(a,b,c,d){var e=a.getStart(),f=Math.round(this._band.dateToPixelOffset(e)),g=a.getColor(),h=a.getClassName();g=h?null:null!=g?g:c.event.duration.color;var i=this._paintEventTick(a,f,g,100,b,c);this._createHighlightDiv(d,i,c)},Timeline.OverviewEventPainter.prototype.paintDurationEvent=function(a,b,c,d){for(var e=a.getLatestStart(),f=a.getEarliestEnd(),g=Math.round(this._band.dateToPixelOffset(e)),h=Math.round(this._band.dateToPixelOffset(f)),i=0;i<this._tracks.length&&!(h<this._tracks[i]);i++);this._tracks[i]=h;var j=a.getColor(),k=a.getClassName();j=k?null:null!=j?j:c.event.duration.color;var l=this._paintEventTape(a,i,g,h,j,100,b,c,k);this._createHighlightDiv(d,l,c)},Timeline.OverviewEventPainter.prototype._paintEventTape=function(a,b,c,d,e,f,g,h,i){var j=g.trackOffset+b*g.trackIncrement,k=d-c,l=g.trackHeight,m=this._timeline.getDocument().createElement("div");return m.className="timeline-small-event-tape",i&&(m.className+=" small-"+i),m.style.left=c+"px",m.style.width=k+"px",m.style.top=j+"px",m.style.height=l+"px",e&&(m.style.backgroundColor=e),100>f&&SimileAjax.Graphics.setOpacity(m,f),this._eventLayer.appendChild(m),{left:c,top:j,width:k,height:l,elmt:m}},Timeline.OverviewEventPainter.prototype._paintEventTick=function(a,b,c,d,e,f){var g=f.event.overviewTrack.tickHeight,h=e.trackOffset-g,i=1,j=this._timeline.getDocument().createElement("div");j.className="timeline-small-event-icon",j.style.left=b+"px",j.style.top=h+"px";var k=a.getClassName();return k&&(j.className+=" small-"+k),100>d&&SimileAjax.Graphics.setOpacity(j,d),this._eventLayer.appendChild(j),{left:b,top:h,width:i,height:g,elmt:j}},Timeline.OverviewEventPainter.prototype._createHighlightDiv=function(a,b,c){if(a>=0){var d=this._timeline.getDocument(),e=c.event,f=e.highlightColors[Math.min(a,e.highlightColors.length-1)],g=d.createElement("div");g.style.position="absolute",g.style.overflow="hidden",g.style.left=b.left-1+"px",g.style.width=b.width+2+"px",g.style.top=b.top-1+"px",g.style.height=b.height+2+"px",g.style.background=f,this._highlightLayer.appendChild(g)}},Timeline.OverviewEventPainter.prototype.showBubble=function(){},Timeline.CompactEventPainter=function(a){this._params=a,this._onSelectListeners=[],this._filterMatcher=null,this._highlightMatcher=null,this._frc=null,this._eventIdToElmt={}},Timeline.CompactEventPainter.prototype.initialize=function(a,b){this._band=a,this._timeline=b,this._backLayer=null,this._eventLayer=null,this._lineLayer=null,this._highlightLayer=null,this._eventIdToElmt=null},Timeline.CompactEventPainter.prototype.addOnSelectListener=function(a){this._onSelectListeners.push(a)},Timeline.CompactEventPainter.prototype.removeOnSelectListener=function(a){for(var b=0;b<this._onSelectListeners.length;b++)if(this._onSelectListeners[b]==a){this._onSelectListeners.splice(b,1);break}},Timeline.CompactEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher},Timeline.CompactEventPainter.prototype.setFilterMatcher=function(a){this._filterMatcher=a},Timeline.CompactEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher},Timeline.CompactEventPainter.prototype.setHighlightMatcher=function(a){this._highlightMatcher=a},Timeline.CompactEventPainter.prototype.paint=function(){var a=this._band.getEventSource();if(null!=a){this._eventIdToElmt={},this._prepareForPainting();var b=this._params.theme,c=b.event,d={trackOffset:"trackOffset"in this._params?this._params.trackOffset:10,trackHeight:"trackHeight"in this._params?this._params.trackHeight:10,tapeHeight:b.event.tape.height,tapeBottomMargin:"tapeBottomMargin"in this._params?this._params.tapeBottomMargin:2,labelBottomMargin:"labelBottomMargin"in this._params?this._params.labelBottomMargin:5,labelRightMargin:"labelRightMargin"in this._params?this._params.labelRightMargin:5,defaultIcon:c.instant.icon,defaultIconWidth:c.instant.iconWidth,defaultIconHeight:c.instant.iconHeight,customIconWidth:"iconWidth"in this._params?this._params.iconWidth:c.instant.iconWidth,customIconHeight:"iconHeight"in this._params?this._params.iconHeight:c.instant.iconHeight,iconLabelGap:"iconLabelGap"in this._params?this._params.iconLabelGap:2,iconBottomMargin:"iconBottomMargin"in this._params?this._params.iconBottomMargin:2};"compositeIcon"in this._params?(d.compositeIcon=this._params.compositeIcon,d.compositeIconWidth=this._params.compositeIconWidth||d.customIconWidth,d.compositeIconHeight=this._params.compositeIconHeight||d.customIconHeight):(d.compositeIcon=d.defaultIcon,d.compositeIconWidth=d.defaultIconWidth,d.compositeIconHeight=d.defaultIconHeight),d.defaultStackIcon="icon"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.icon:d.defaultIcon,d.defaultStackIconWidth="iconWidth"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.iconWidth:d.defaultIconWidth,d.defaultStackIconHeight="iconHeight"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.iconHeight:d.defaultIconHeight;var e=this._band.getMinDate(),f=this._band.getMaxDate(),g=null!=this._filterMatcher?this._filterMatcher:function(){return!0},h=null!=this._highlightMatcher?this._highlightMatcher:function(){return-1},i=a.getEventIterator(e,f),j="stackConcurrentPreciseInstantEvents"in this._params&&"object"==typeof this._params.stackConcurrentPreciseInstantEvents,k="collapseConcurrentPreciseInstantEvents"in this._params&&this._params.collapseConcurrentPreciseInstantEvents;if(k||j){for(var l=[],m=null;i.hasNext();){var n=i.next();g(n)&&(!n.isInstant()||n.isImprecise()?this.paintEvent(n,d,this._params.theme,h(n)):null!=m&&m.getStart().getTime()==n.getStart().getTime()?l[l.length-1].push(n):(l.push([n]),m=n))}for(var o=0;o<l.length;o++){var p=l[o];if(1==p.length)this.paintEvent(p[0],d,this._params.theme,h(n));else{for(var q=-1,r=0;0>q&&r<p.length;r++)q=h(p[r]);j?this.paintStackedPreciseInstantEvents(p,d,this._params.theme,q):this.paintCompositePreciseInstantEvents(p,d,this._params.theme,q)}}}else for(;i.hasNext();){var n=i.next();g(n)&&this.paintEvent(n,d,this._params.theme,h(n))}this._highlightLayer.style.display="block",this._lineLayer.style.display="block",this._eventLayer.style.display="block"}},Timeline.CompactEventPainter.prototype.softPaint=function(){},Timeline.CompactEventPainter.prototype._prepareForPainting=function(){var a=this._band;if(null==this._backLayer){this._backLayer=this._band.createLayerDiv(0,"timeline-band-events"),this._backLayer.style.visibility="hidden";var b=document.createElement("span");b.className="timeline-event-label",this._backLayer.appendChild(b),this._frc=SimileAjax.Graphics.getFontRenderingContext(b)}this._frc.update(),this._tracks=[],null!=this._highlightLayer&&a.removeLayerDiv(this._highlightLayer),this._highlightLayer=a.createLayerDiv(105,"timeline-band-highlights"),this._highlightLayer.style.display="none",null!=this._lineLayer&&a.removeLayerDiv(this._lineLayer),this._lineLayer=a.createLayerDiv(110,"timeline-band-lines"),this._lineLayer.style.display="none",null!=this._eventLayer&&a.removeLayerDiv(this._eventLayer),this._eventLayer=a.createLayerDiv(115,"timeline-band-events"),this._eventLayer.style.display="none"},Timeline.CompactEventPainter.prototype.paintEvent=function(a,b,c,d){a.isInstant()?this.paintInstantEvent(a,b,c,d):this.paintDurationEvent(a,b,c,d)},Timeline.CompactEventPainter.prototype.paintInstantEvent=function(a,b,c,d){a.isImprecise()?this.paintImpreciseInstantEvent(a,b,c,d):this.paintPreciseInstantEvent(a,b,c,d)},Timeline.CompactEventPainter.prototype.paintDurationEvent=function(a,b,c,d){a.isImprecise()?this.paintImpreciseDurationEvent(a,b,c,d):this.paintPreciseDurationEvent(a,b,c,d)},Timeline.CompactEventPainter.prototype.paintPreciseInstantEvent=function(a,b,c,d){var e={tooltip:a.getProperty("tooltip")||a.getText()},f={url:a.getIcon()};null==f.url?(f.url=b.defaultIcon,f.width=b.defaultIconWidth,f.height=b.defaultIconHeight,f.className="timeline-event-icon-default"):(f.width=a.getProperty("iconWidth")||b.customIconWidth,f.height=a.getProperty("iconHeight")||b.customIconHeight);var g={text:a.getText(),color:a.getTextColor()||a.getColor(),className:a.getClassName()},h=this.paintTapeIconLabel(a.getStart(),e,null,f,g,b,c,d),i=this,j=function(b,c){return i._onClickInstantEvent(h.iconElmtData.elmt,c,a)};SimileAjax.DOM.registerEvent(h.iconElmtData.elmt,"mousedown",j),SimileAjax.DOM.registerEvent(h.labelElmtData.elmt,"mousedown",j),this._eventIdToElmt[a.getID()]=h.iconElmtData.elmt},Timeline.CompactEventPainter.prototype.paintCompositePreciseInstantEvents=function(a,b,c,d){for(var e=a[0],f=[],g=0;g<a.length;g++)f.push(a[g].getProperty("tooltip")||a[g].getText());var h={tooltip:f.join("; ")},i={url:b.compositeIcon,width:b.compositeIconWidth,height:b.compositeIconHeight,className:"timeline-event-icon-composite"},j={text:String.substitute(this._params.compositeEventLabelTemplate,[a.length])},k=this.paintTapeIconLabel(e.getStart(),h,null,i,j,b,c,d),l=this,m=function(b,c){return l._onClickMultiplePreciseInstantEvent(k.iconElmtData.elmt,c,a)};SimileAjax.DOM.registerEvent(k.iconElmtData.elmt,"mousedown",m),SimileAjax.DOM.registerEvent(k.labelElmtData.elmt,"mousedown",m);for(var g=0;g<a.length;g++)this._eventIdToElmt[a[g].getID()]=k.iconElmtData.elmt},Timeline.CompactEventPainter.prototype.paintStackedPreciseInstantEvents=function(a,b,c){for(var d=("limit"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.limit:10),e=("moreMessageTemplate"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.moreMessageTemplate:"%0 More Events"),f=d<=a.length-2,g=this._band,h=function(a){return Math.round(g.dateToPixelOffset(a))},i=function(a){var c={url:a.getIcon()};return null==c.url?(c.url=b.defaultStackIcon,c.width=b.defaultStackIconWidth,c.height=b.defaultStackIconHeight,c.className="timeline-event-icon-stack timeline-event-icon-default"):(c.width=a.getProperty("iconWidth")||b.customIconWidth,c.height=a.getProperty("iconHeight")||b.customIconHeight,c.className="timeline-event-icon-stack"),c},j=i(a[0]),k=5,l=0,m=0,n=0,o=0,p=[],q=0;q<a.length&&(!f||d>q);q++){var r=a[q],s=r.getText(),t=i(r),u=this._frc.computeSize(s),v={text:s,iconData:t,labelSize:u,iconLeft:j.width+q*k-t.width};v.labelLeft=j.width+q*k+b.iconLabelGap,v.top=n,p.push(v),l=Math.min(l,v.iconLeft),n+=u.height,m=Math.max(m,v.labelLeft+u.width),o=Math.max(o,v.top+t.height)}if(f){var w=String.substitute(e,[a.length-d]),x=this._frc.computeSize(w),y=j.width+(d-1)*k+b.iconLabelGap,z=n;n+=x.height,m=Math.max(m,y+x.width)}m+=b.labelRightMargin,n+=b.labelBottomMargin,o+=b.iconBottomMargin;for(var A=h(a[0].getStart()),B=[],C=Math.ceil(Math.max(o,n)/b.trackHeight),D=j.width+(a.length-1)*k,q=0;C>q;q++)B.push({start:l,end:D});for(var E=Math.ceil(n/b.trackHeight),q=0;E>q;q++){var F=B[q];F.end=Math.max(F.end,m)}var G=this._fitTracks(A,B),H=G*b.trackHeight+b.trackOffset,I=this._timeline.getDocument().createElement("div");I.className="timeline-event-icon-stack",I.style.position="absolute",I.style.overflow="visible",I.style.left=A+"px",I.style.top=H+"px",I.style.width=D+"px",I.style.height=o+"px",I.innerHTML="<div style='position: relative'></div>",this._eventLayer.appendChild(I);for(var J=this,K=function(){try{for(var a=parseInt(this.getAttribute("index")),b=I.firstChild.childNodes,c=0;c<b.length;c++){var d=b[c];d.style.zIndex=c==a?b.length:b.length-c}}catch(e){}},L=(function(b){var d=p[b],e=a[b],f=e.getProperty("tooltip")||e.getText(),g=J._paintEventLabel({tooltip:f},{text:d.text},A+d.labelLeft,H+d.top,d.labelSize.width,d.labelSize.height,c);g.elmt.setAttribute("index",b),g.elmt.onmouseover=K;var h=SimileAjax.Graphics.createTranslucentImage(d.iconData.url),i=J._timeline.getDocument().createElement("div");i.className="timeline-event-icon"+("className"in d.iconData?" "+d.iconData.className:""),i.style.left=d.iconLeft+"px",i.style.top=d.top+"px",i.style.zIndex=p.length-b,i.appendChild(h),i.setAttribute("index",b),i.onmouseover=K,I.firstChild.appendChild(i);var j=function(a,b){return J._onClickInstantEvent(g.elmt,b,e)};SimileAjax.DOM.registerEvent(i,"mousedown",j),SimileAjax.DOM.registerEvent(g.elmt,"mousedown",j),J._eventIdToElmt[e.getID()]=i}),q=0;q<p.length;q++)L(q);if(f){var M=a.slice(d),N=this._paintEventLabel({tooltip:w},{text:w},A+y,H+z,x.width,x.height,c),O=function(a,b){return J._onClickMultiplePreciseInstantEvent(N.elmt,b,M)};SimileAjax.DOM.registerEvent(N.elmt,"mousedown",O);for(var q=0;q<M.length;q++)this._eventIdToElmt[M[q].getID()]=N.elmt}},Timeline.CompactEventPainter.prototype.paintImpreciseInstantEvent=function(a,b,c,d){var e={tooltip:a.getProperty("tooltip")||a.getText()},f={start:a.getStart(),end:a.getEnd(),latestStart:a.getLatestStart(),earliestEnd:a.getEarliestEnd(),isInstant:!0},g={url:a.getIcon()};null==g.url?g=null:(g.width=a.getProperty("iconWidth")||b.customIconWidth,g.height=a.getProperty("iconHeight")||b.customIconHeight);var h={text:a.getText(),color:a.getTextColor()||a.getColor(),className:a.getClassName()},i=this.paintTapeIconLabel(a.getStart(),e,f,g,h,b,c,d),j=this,k=null!=g?function(b,c){return j._onClickInstantEvent(i.iconElmtData.elmt,c,a)}:function(b,c){return j._onClickInstantEvent(i.labelElmtData.elmt,c,a)};SimileAjax.DOM.registerEvent(i.labelElmtData.elmt,"mousedown",k),SimileAjax.DOM.registerEvent(i.impreciseTapeElmtData.elmt,"mousedown",k),null!=g?(SimileAjax.DOM.registerEvent(i.iconElmtData.elmt,"mousedown",k),this._eventIdToElmt[a.getID()]=i.iconElmtData.elmt):this._eventIdToElmt[a.getID()]=i.labelElmtData.elmt},Timeline.CompactEventPainter.prototype.paintPreciseDurationEvent=function(a,b,c,d){var e={tooltip:a.getProperty("tooltip")||a.getText()},f={start:a.getStart(),end:a.getEnd(),isInstant:!1},g={url:a.getIcon()};null==g.url?g=null:(g.width=a.getProperty("iconWidth")||b.customIconWidth,g.height=a.getProperty("iconHeight")||b.customIconHeight);var h={text:a.getText(),color:a.getTextColor()||a.getColor(),className:a.getClassName()},i=this.paintTapeIconLabel(a.getLatestStart(),e,f,g,h,b,c,d),j=this,k=null!=g?function(b,c){return j._onClickInstantEvent(i.iconElmtData.elmt,c,a)}:function(b,c){return j._onClickInstantEvent(i.labelElmtData.elmt,c,a)};SimileAjax.DOM.registerEvent(i.labelElmtData.elmt,"mousedown",k),SimileAjax.DOM.registerEvent(i.tapeElmtData.elmt,"mousedown",k),null!=g?(SimileAjax.DOM.registerEvent(i.iconElmtData.elmt,"mousedown",k),this._eventIdToElmt[a.getID()]=i.iconElmtData.elmt):this._eventIdToElmt[a.getID()]=i.labelElmtData.elmt},Timeline.CompactEventPainter.prototype.paintImpreciseDurationEvent=function(a,b,c,d){var e={tooltip:a.getProperty("tooltip")||a.getText()},f={start:a.getStart(),end:a.getEnd(),latestStart:a.getLatestStart(),earliestEnd:a.getEarliestEnd(),isInstant:!1},g={url:a.getIcon()};null==g.url?g=null:(g.width=a.getProperty("iconWidth")||b.customIconWidth,g.height=a.getProperty("iconHeight")||b.customIconHeight);var h={text:a.getText(),color:a.getTextColor()||a.getColor(),className:a.getClassName()},i=this.paintTapeIconLabel(a.getLatestStart(),e,f,g,h,b,c,d),j=this,k=null!=g?function(b,c){return j._onClickInstantEvent(i.iconElmtData.elmt,c,a)}:function(b,c){return j._onClickInstantEvent(i.labelElmtData.elmt,c,a)};SimileAjax.DOM.registerEvent(i.labelElmtData.elmt,"mousedown",k),SimileAjax.DOM.registerEvent(i.tapeElmtData.elmt,"mousedown",k),null!=g?(SimileAjax.DOM.registerEvent(i.iconElmtData.elmt,"mousedown",k),this._eventIdToElmt[a.getID()]=i.iconElmtData.elmt):this._eventIdToElmt[a.getID()]=i.labelElmtData.elmt},Timeline.CompactEventPainter.prototype.paintTapeIconLabel=function(a,b,c,d,e,f,g){var h=this._band,i=function(a){return Math.round(h.dateToPixelOffset(a))},j=i(a),k=[],l=0,m=0,n=0;if(null!=c){l=f.tapeHeight+f.tapeBottomMargin,m=Math.ceil(f.tapeHeight/f.trackHeight);for(var o=i(c.end)-j,p=i(c.start)-j,q=0;m>q;q++)k.push({start:p,end:o});n=f.trackHeight-l%f.tapeHeight}var r=0,s=0;if(null!=d){"iconAlign"in d&&"center"==d.iconAlign&&(r=-Math.floor(d.width/2)),s=r+d.width+f.iconLabelGap,m>0&&(k[m-1].end=Math.max(k[m-1].end,s));for(var t=d.height+f.iconBottomMargin+n;t>0;)k.push({start:r,end:s}),t-=f.trackHeight}var u=e.text,v=this._frc.computeSize(u),w=v.height+f.labelBottomMargin+n,x=s+v.width+f.labelRightMargin;m>0&&(k[m-1].end=Math.max(k[m-1].end,x));for(var y=0;w>0;y++){if(m+y<k.length){var z=k[m+y];z.end=x}else k.push({start:0,end:x});w-=f.trackHeight}var A=this._fitTracks(j,k),B=A*f.trackHeight+f.trackOffset,C={};return C.labelElmtData=this._paintEventLabel(b,e,j+s,B+l,v.width,v.height,g),null!=c&&(("latestStart"in c||"earliestEnd"in c)&&(C.impreciseTapeElmtData=this._paintEventTape(b,c,f.tapeHeight,B,i(c.start),i(c.end),g.event.duration.impreciseColor,g.event.duration.impreciseOpacity,f,g)),!c.isInstant&&"start"in c&&"end"in c&&(C.tapeElmtData=this._paintEventTape(b,c,f.tapeHeight,B,j,i("earliestEnd"in c?c.earliestEnd:c.end),c.color,100,f,g))),null!=d&&(C.iconElmtData=this._paintEventIcon(b,d,B+l,j+r,f,g)),C},Timeline.CompactEventPainter.prototype._fitTracks=function(a,b){var c;for(c=0;c<this._tracks.length;c++){for(var d=!0,e=0;e<b.length&&c+e<this._tracks.length;e++){var f=this._tracks[c+e],g=b[e];if(a+g.start<f){d=!1;break}}if(d)break}for(var h=0;h<b.length;h++)this._tracks[c+h]=a+b[h].end;return c},Timeline.CompactEventPainter.prototype._paintEventIcon=function(a,b,c,d,e){var f=SimileAjax.Graphics.createTranslucentImage(b.url),g=this._timeline.getDocument().createElement("div");return g.className="timeline-event-icon"+("className"in b?" "+b.className:""),g.style.left=d+"px",g.style.top=c+"px",g.appendChild(f),"tooltip"in a&&"string"==typeof a.tooltip&&(g.title=a.tooltip),this._eventLayer.appendChild(g),{left:d,top:c,width:e.iconWidth,height:e.iconHeight,elmt:g}},Timeline.CompactEventPainter.prototype._paintEventLabel=function(a,b,c,d,e,f){var g=this._timeline.getDocument(),h=g.createElement("div");return h.className="timeline-event-label",h.style.left=c+"px",h.style.width=e+1+"px",h.style.top=d+"px",h.innerHTML=b.text,"tooltip"in a&&"string"==typeof a.tooltip&&(h.title=a.tooltip),"color"in b&&"string"==typeof b.color&&(h.style.color=b.color),"className"in b&&"string"==typeof b.className&&(h.className+=" "+b.className),this._eventLayer.appendChild(h),{left:c,top:d,width:e,height:f,elmt:h}},Timeline.CompactEventPainter.prototype._paintEventTape=function(a,b,c,d,e,f,g,h){var i=f-e,j=this._timeline.getDocument().createElement("div");return j.className="timeline-event-tape",j.style.left=e+"px",j.style.top=d+"px",j.style.width=i+"px",j.style.height=c+"px","tooltip"in a&&"string"==typeof a.tooltip&&(j.title=a.tooltip),null!=g&&"string"==typeof b.color&&(j.style.backgroundColor=g),"backgroundImage"in b&&"string"==typeof b.backgroundImage&&(j.style.backgroundImage="url("+backgroundImage+")",j.style.backgroundRepeat="backgroundRepeat"in b&&"string"==typeof b.backgroundRepeat?b.backgroundRepeat:"repeat"),SimileAjax.Graphics.setOpacity(j,h),"className"in b&&"string"==typeof b.className&&(j.className+=" "+b.className),this._eventLayer.appendChild(j),{left:e,top:d,width:i,height:c,elmt:j}},Timeline.CompactEventPainter.prototype._createHighlightDiv=function(a,b,c){if(a>=0){var d=this._timeline.getDocument(),e=c.event,f=(e.highlightColors[Math.min(a,e.highlightColors.length-1)],d.createElement("div"));f.style.position="absolute",f.style.overflow="hidden",f.style.left=b.left-2+"px",f.style.width=b.width+4+"px",f.style.top=b.top-2+"px",f.style.height=b.height+4+"px",this._highlightLayer.appendChild(f)}},Timeline.CompactEventPainter.prototype._onClickMultiplePreciseInstantEvent=function(a,b,c){var d=SimileAjax.DOM.getPageCoordinates(a);this._showBubble(d.left+Math.ceil(a.offsetWidth/2),d.top+Math.ceil(a.offsetHeight/2),c);for(var e=[],f=0;f<c.length;f++)e.push(c[f].getID());return this._fireOnSelect(e),b.cancelBubble=!0,SimileAjax.DOM.cancelEvent(b),!1},Timeline.CompactEventPainter.prototype._onClickInstantEvent=function(a,b,c){var d=SimileAjax.DOM.getPageCoordinates(a);return this._showBubble(d.left+Math.ceil(a.offsetWidth/2),d.top+Math.ceil(a.offsetHeight/2),[c]),this._fireOnSelect([c.getID()]),b.cancelBubble=!0,SimileAjax.DOM.cancelEvent(b),!1},Timeline.CompactEventPainter.prototype._onClickDurationEvent=function(a,b,c){if("pageX"in b)var d=b.pageX,e=b.pageY;else var f=SimileAjax.DOM.getPageCoordinates(a),d=b.offsetX+f.left,e=b.offsetY+f.top;return this._showBubble(d,e,[c]),this._fireOnSelect([c.getID()]),b.cancelBubble=!0,SimileAjax.DOM.cancelEvent(b),!1},Timeline.CompactEventPainter.prototype.showBubble=function(a){var b=this._eventIdToElmt[a.getID()];if(b){var c=SimileAjax.DOM.getPageCoordinates(b);this._showBubble(c.left+b.offsetWidth/2,c.top+b.offsetHeight/2,[a])}},Timeline.CompactEventPainter.prototype._showBubble=function(a,b,c){var d=document.createElement("div");c="fillInfoBubble"in c?[c]:c;for(var e=0;e<c.length;e++){var f=document.createElement("div");d.appendChild(f),c[e].fillInfoBubble(f,this._params.theme,this._band.getLabeller());

}SimileAjax.WindowManager.cancelPopups(),SimileAjax.Graphics.createBubbleForContentAndPoint(d,a,b,this._params.theme.event.bubble.width)},Timeline.CompactEventPainter.prototype._fireOnSelect=function(a){for(var b=0;b<this._onSelectListeners.length;b++)this._onSelectListeners[b](a)},Timeline.SpanHighlightDecorator=function(a){this._unit=null!=a.unit?a.unit:SimileAjax.NativeDateUnit,this._startDate="string"==typeof a.startDate?this._unit.parseFromObject(a.startDate):a.startDate,this._endDate="string"==typeof a.endDate?this._unit.parseFromObject(a.endDate):a.endDate,this._startLabel=null!=a.startLabel?a.startLabel:"",this._endLabel=null!=a.endLabel?a.endLabel:"",this._color=a.color,this._cssClass=null!=a.cssClass?a.cssClass:null,this._opacity=null!=a.opacity?a.opacity:100,this._zIndex=null!=a.inFront&&a.inFront?113:10},Timeline.SpanHighlightDecorator.prototype.initialize=function(a,b){this._band=a,this._timeline=b,this._layerDiv=null},Timeline.SpanHighlightDecorator.prototype.paint=function(){null!=this._layerDiv&&this._band.removeLayerDiv(this._layerDiv),this._layerDiv=this._band.createLayerDiv(this._zIndex),this._layerDiv.setAttribute("name","span-highlight-decorator"),this._layerDiv.style.display="none";var a=this._band.getMinDate(),b=this._band.getMaxDate();if(this._unit.compare(this._startDate,b)<0&&this._unit.compare(this._endDate,a)>0){a=this._unit.later(a,this._startDate),b=this._unit.earlier(b,this._endDate);var c=this._band.dateToPixelOffset(a),d=this._band.dateToPixelOffset(b),e=this._timeline.getDocument(),f=function(){var a=e.createElement("table");return a.insertRow(0).insertCell(0),a},g=e.createElement("div");g.className="timeline-highlight-decorator",this._cssClass&&(g.className+=" "+this._cssClass),null!=this._color&&(g.style.backgroundColor=this._color),this._opacity<100&&SimileAjax.Graphics.setOpacity(g,this._opacity),this._layerDiv.appendChild(g);var h=f();h.className="timeline-highlight-label timeline-highlight-label-start";var i=h.rows[0].cells[0];i.innerHTML=this._startLabel,this._cssClass&&(i.className="label_"+this._cssClass),this._layerDiv.appendChild(h);var j=f();j.className="timeline-highlight-label timeline-highlight-label-end";var k=j.rows[0].cells[0];k.innerHTML=this._endLabel,this._cssClass&&(k.className="label_"+this._cssClass),this._layerDiv.appendChild(j),this._timeline.isHorizontal()?(g.style.left=c+"px",g.style.width=d-c+"px",h.style.right=this._band.getTotalViewLength()-c+"px",h.style.width=this._startLabel.length+"em",j.style.left=d+"px",j.style.width=this._endLabel.length+"em"):(g.style.top=c+"px",g.style.height=d-c+"px",h.style.bottom=c+"px",h.style.height="1.5px",j.style.top=d+"px",j.style.height="1.5px")}this._layerDiv.style.display="block"},Timeline.SpanHighlightDecorator.prototype.softPaint=function(){},Timeline.PointHighlightDecorator=function(a){this._unit=null!=a.unit?a.unit:SimileAjax.NativeDateUnit,this._date="string"==typeof a.date?this._unit.parseFromObject(a.date):a.date,this._width=null!=a.width?a.width:10,this._color=a.color,this._cssClass=null!=a.cssClass?a.cssClass:"",this._opacity=null!=a.opacity?a.opacity:100},Timeline.PointHighlightDecorator.prototype.initialize=function(a,b){this._band=a,this._timeline=b,this._layerDiv=null},Timeline.PointHighlightDecorator.prototype.paint=function(){null!=this._layerDiv&&this._band.removeLayerDiv(this._layerDiv),this._layerDiv=this._band.createLayerDiv(10),this._layerDiv.setAttribute("name","span-highlight-decorator"),this._layerDiv.style.display="none";var a=this._band.getMinDate(),b=this._band.getMaxDate();if(this._unit.compare(this._date,b)<0&&this._unit.compare(this._date,a)>0){var c=this._band.dateToPixelOffset(this._date),d=c-Math.round(this._width/2),e=this._timeline.getDocument(),f=e.createElement("div");f.className="timeline-highlight-point-decorator",f.className+=" "+this._cssClass,null!=this._color&&(f.style.backgroundColor=this._color),this._opacity<100&&SimileAjax.Graphics.setOpacity(f,this._opacity),this._layerDiv.appendChild(f),this._timeline.isHorizontal()?(f.style.left=d+"px",f.style.width=this._width):(f.style.top=d+"px",f.style.height=this._width)}this._layerDiv.style.display="block"},Timeline.PointHighlightDecorator.prototype.softPaint=function(){},Timeline.NativeDateUnit=new Object,Timeline.NativeDateUnit.createLabeller=function(a,b){return new Timeline.GregorianDateLabeller(a,b)},Timeline.NativeDateUnit.makeDefaultValue=function(){return new Date},Timeline.NativeDateUnit.cloneValue=function(a){return new Date(a.getTime())},Timeline.NativeDateUnit.getParser=function(a){return"string"==typeof a&&(a=a.toLowerCase()),"iso8601"==a||"iso 8601"==a?Timeline.DateTime.parseIso8601DateTime:Timeline.DateTime.parseGregorianDateTime},Timeline.NativeDateUnit.parseFromObject=function(a){return Timeline.DateTime.parseGregorianDateTime(a)},Timeline.NativeDateUnit.toNumber=function(a){return a.getTime()},Timeline.NativeDateUnit.fromNumber=function(a){return new Date(a)},Timeline.NativeDateUnit.compare=function(a,b){var c,d;return c="object"==typeof a?a.getTime():Number(a),d="object"==typeof b?b.getTime():Number(b),c-d},Timeline.NativeDateUnit.earlier=function(a,b){return Timeline.NativeDateUnit.compare(a,b)<0?a:b},Timeline.NativeDateUnit.later=function(a,b){return Timeline.NativeDateUnit.compare(a,b)>0?a:b},Timeline.NativeDateUnit.change=function(a,b){return new Date(a.getTime()+b)};